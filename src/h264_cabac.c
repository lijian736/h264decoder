#include "h264decoder/h264_cabac.h"

#include "h264decoder/h264_math.h"

/* @see Table 9-12 – Values of variables m and n for ctxIdx from 0 to 10 */
static const int8_t mn_0_10[11][2] = {
    {20, -15}, {2, 54}, {3, 74}, {20, -15}, {2, 54}, {3, 74}, {-28, 127}, {-23, 104}, {-6, 53}, {-1, 54}, {7, 51},
};

/* @see Table 9-13 – Values of variables m and n for ctxIdx from 11 to 23. the first dimension is cabac_init_idc */
static const int8_t mn_11_23[3][13][2] = {
    {{23, 33}, {23, 2}, {21, 0}, {1, 9}, {0, 49}, {-37, 118}, {5, 57}, {-13, 78}, {-11, 65}, {1, 62}, {12, 49}, {-4, 73}, {17, 50}},
    {{22, 25}, {34, 0}, {16, 0}, {-2, 9}, {4, 41}, {-29, 118}, {2, 65}, {-6, 71}, {-13, 79}, {5, 52}, {9, 50}, {-3, 70}, {10, 54}},
    {{29, 16}, {25, 0}, {14, 0}, {-10, 51}, {-3, 62}, {-27, 99}, {26, 16}, {-4, 85}, {-24, 102}, {5, 57}, {6, 57}, {-17, 73}, {14, 57}},
};

/* @see Table 9-14 – Values of variables m and n for ctxIdx from 24 to 39. the first dimension is cabac_init_idc */
static const int8_t mn_24_39[3][16][2] = {
    {{18, 64}, {9, 43}, {29, 0}, {26, 67}, {16, 90}, {9, 104}, {-46, 127}, {-20, 104}, {1, 67}, {-13, 78}, {-11, 65}, {1, 62}, {-6, 86}, {-17, 95}, {-6, 61}, {9, 45}},
    {{26, 34}, {19, 22}, {40, 0}, {57, 2}, {41, 36}, {26, 69}, {-45, 127}, {-15, 101}, {-4, 76}, {-6, 71}, {-13, 79}, {5, 52}, {6, 69}, {-13, 90}, {0, 52}, {8, 43}},
    {{20, 40}, {20, 10}, {29, 0}, {54, 0}, {37, 42}, {12, 97}, {-32, 127}, {-22, 117}, {-2, 74}, {-4, 85}, {-24, 102}, {5, 57}, {-6, 93}, {-14, 88}, {-6, 44}, {4, 55}},
};

/* @see Table 9-15 – Values of variables m and n for ctxIdx from 40 to 53. the first dimension is cabac_init_idc*/
static const int8_t mn_40_53[3][14][2] = {
    {{-3, 69}, {-6, 81}, {-11, 96}, {6, 55}, {7, 67}, {-5, 86}, {2, 88}, {0, 58}, {-3, 76}, {-10, 94}, {5, 54}, {4, 69}, {-3, 81}, {0, 88}},
    {{-2, 69}, {-5, 82}, {-10, 96}, {2, 59}, {2, 75}, {-3, 87}, {-3, 100}, {1, 56}, {-3, 74}, {-6, 85}, {0, 59}, {-3, 81}, {-7, 86}, {-5, 95}},
    {{-11, 89}, {-15, 103}, {-21, 116}, {19, 57}, {20, 58}, {4, 84}, {6, 96}, {1, 63}, {-5, 85}, {-13, 106}, {5, 63}, {6, 75}, {-3, 90}, {-1, 101}},
};

/* @see Table 9-16 – Values of variables m and n for ctxIdx from 54 to 59. the first dimension is cabac_init_idc */
static const int8_t mn_54_59[3][6][2] = {
    {{-7, 67}, {-5, 74}, {-4, 74}, {-5, 80}, {-7, 72}, {1, 58}},
    {{-1, 66}, {-1, 77}, {1, 70}, {-2, 86}, {-5, 72}, {0, 61}},
    {{3, 55}, {-4, 79}, {-2, 75}, {-12, 97}, {-7, 50}, {1, 60}},
};

/* @see Table 9-16 – Values of variables m and n for ctxIdx from 399 to 401. the first dimension is I slices(0) and the cabac_init_idc(1,2,3)*/
static const int8_t mn_399_401[4][3][2] = {
    {{31, 21}, {31, 31}, {25, 50}},
    {{12, 40}, {11, 51}, {14, 59}},
    {{25, 32}, {21, 49}, {21, 54}},
    {{21, 33}, {19, 50}, {17, 61}},
};

/* @see Table 9-17 – Values of variables m and n for ctxIdx from 60 to 69 */
static const int8_t mn_60_69[10][2] = {
    {0, 41}, {0, 63}, {0, 63}, {0, 63}, {-9, 83}, {4, 86}, {0, 97}, {-7, 72}, {13, 41}, {3, 62},
};

/* @see Table 9-18 – Values of variables m and n for ctxIdx from 70 to 104. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_70_104[4][35][2] = {
    {{0, 11},    {1, 55},    {0, 69},    {-17, 127}, {-13, 102}, {0, 82},    {-7, 74},   {-21, 107}, {-27, 127}, {-31, 127}, {-24, 127}, {-18, 95},
     {-27, 127}, {-21, 114}, {-30, 127}, {-17, 123}, {-12, 115}, {-16, 122}, {-11, 115}, {-12, 63},  {-2, 68},   {-15, 84},  {-13, 104}, {-3, 70},
     {-8, 93},   {-10, 90},  {-30, 127}, {-1, 74},   {-6, 97},   {-7, 91},   {-20, 127}, {-4, 56},   {-5, 82},   {-7, 76},   {-22, 125}},
    {{0, 45},    {-4, 78},  {-3, 96},   {-27, 126}, {-28, 98}, {-25, 101}, {-23, 67},  {-28, 82}, {-20, 94}, {-16, 83}, {-22, 110}, {-21, 91},
     {-18, 102}, {-13, 93}, {-29, 127}, {-7, 92},   {-5, 89},  {-7, 96},   {-13, 108}, {-3, 46},  {-1, 65},  {-1, 57},  {-9, 93},   {-3, 74},
     {-9, 92},   {-8, 87},  {-23, 126}, {5, 54},    {6, 60},   {6, 59},    {6, 69},    {-1, 48},  {0, 68},   {-4, 69},  {-8, 88}},
    {{13, 15},   {7, 51},    {2, 80},    {-39, 127}, {-18, 91}, {-17, 96}, {-26, 81}, {-35, 98}, {-24, 102}, {-23, 97}, {-27, 119}, {-24, 99},
     {-21, 110}, {-18, 102}, {-36, 127}, {0, 80},    {-5, 89},  {-7, 94},  {-4, 92},  {0, 39},   {0, 65},    {-15, 84}, {-35, 127}, {-2, 73},
     {-12, 104}, {-9, 91},   {-31, 127}, {3, 55},    {7, 56},   {7, 55},   {8, 61},   {-3, 53},  {0, 68},    {-7, 74},  {-9, 88}},
    {{7, 34},    {-9, 88},  {-20, 127}, {-36, 127}, {-17, 91}, {-14, 95}, {-25, 84}, {-25, 86}, {-12, 89}, {-17, 91}, {-31, 127}, {-14, 76},
     {-18, 103}, {-13, 90}, {-37, 127}, {11, 80},   {5, 76},   {2, 84},   {5, 78},   {-6, 55},  {4, 61},   {-14, 83}, {-37, 127}, {-5, 79},
     {-11, 104}, {-11, 91}, {-30, 127}, {0, 65},    {-2, 79},  {0, 72},   {-4, 92},  {-6, 56},  {3, 68},   {-8, 71},  {-13, 98}},
};

/* @see Table 9-19 – Values of variables m and n for ctxIdx from 105 to 165. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_105_165[4][61][2] = {
    {{-7, 93},  {-11, 87}, {-3, 77},  {-5, 71},  {-4, 63},  {-4, 68}, {-12, 84}, {-7, 62},  {-7, 65},  {8, 61}, {5, 56},  {-2, 66}, {1, 64},   {0, 61},    {-2, 78},   {1, 50},
     {7, 52},   {10, 35},  {0, 44},   {11, 38},  {1, 45},   {0, 46},  {5, 44},   {31, 17},  {1, 51},   {7, 50}, {28, 19}, {16, 33}, {14, 62},  {-13, 108}, {-15, 100}, {-13, 101},
     {-13, 91}, {-12, 94}, {-10, 88}, {-16, 84}, {-10, 86}, {-7, 83}, {-13, 87}, {-19, 94}, {1, 70},   {0, 72}, {-5, 74}, {18, 59}, {-8, 102}, {-15, 100}, {0, 95},    {-4, 75},
     {2, 72},   {-11, 75}, {-3, 71},  {15, 46},  {-13, 69}, {0, 62},  {0, 65},   {21, 37},  {-15, 72}, {9, 57}, {16, 54}, {0, 62},  {12, 72}},
    {{-2, 85}, {-6, 78}, {-1, 75}, {-7, 77},  {2, 54},  {5, 50},  {-3, 68}, {1, 50},   {6, 42},  {-4, 81}, {1, 63},  {-4, 70}, {0, 67},   {2, 57}, {-2, 76}, {11, 35},
     {4, 64},  {1, 61},  {11, 35}, {18, 25},  {12, 24}, {13, 29}, {13, 36}, {-10, 93}, {-7, 73}, {-2, 73}, {13, 46}, {9, 49},  {-7, 100}, {9, 53}, {2, 53},  {5, 53},
     {-2, 61}, {0, 56},  {0, 56},  {-13, 63}, {-5, 60}, {-1, 62}, {4, 57},  {-6, 69},  {4, 57},  {14, 39}, {4, 51},  {13, 68}, {3, 64},   {1, 61}, {9, 63},  {7, 50},
     {16, 39}, {5, 44},  {4, 52},  {11, 48},  {-5, 60}, {-1, 59}, {0, 59},  {22, 33},  {5, 44},  {14, 43}, {-1, 78}, {0, 60},  {9, 69}},
    {{-13, 103}, {-13, 91},  {-9, 89},   {-14, 92}, {-8, 76}, {-12, 87}, {-23, 110}, {-24, 105}, {-10, 78}, {-20, 112}, {-17, 99}, {-78, 127}, {-70, 127},
     {-50, 127}, {-46, 127}, {-4, 66},   {-5, 78},  {-4, 71}, {-8, 72},  {2, 59},    {-1, 55},   {-7, 70},  {-6, 75},   {-8, 89},  {-34, 119}, {-3, 75},
     {32, 20},   {30, 22},   {-44, 127}, {0, 54},   {-5, 61}, {0, 58},   {-1, 60},   {-3, 61},   {-8, 67},  {-25, 84},  {-14, 74}, {-5, 65},   {5, 52},
     {2, 57},    {0, 61},    {-9, 69},   {-11, 70}, {18, 55}, {-4, 71},  {0, 58},    {7, 61},    {9, 41},   {18, 25},   {9, 32},   {5, 43},    {9, 47},
     {0, 44},    {0, 51},    {2, 46},    {19, 38},  {-4, 66}, {15, 38},  {12, 42},   {9, 34},    {0, 89}},
    {{-4, 86}, {-12, 88}, {-5, 82},  {-3, 72},  {-4, 67},  {-8, 72},  {-16, 89}, {-9, 69}, {-1, 59},   {5, 66},   {4, 57},   {-4, 71},  {-2, 71},  {2, 58},  {-1, 74},  {-4, 44},
     {-1, 69}, {0, 62},   {-7, 51},  {-4, 47},  {-6, 42},  {-3, 41},  {-6, 53},  {8, 76},  {-9, 78},   {-11, 83}, {9, 52},   {0, 67},   {-5, 90},  {1, 67},  {-15, 72}, {-5, 75},
     {-8, 80}, {-21, 83}, {-21, 64}, {-13, 31}, {-25, 64}, {-29, 94}, {9, 75},   {17, 63}, {-8, 74},   {-5, 35},  {-2, 27},  {13, 91},  {3, 65},   {-7, 69}, {8, 77},   {-10, 66},
     {3, 62},  {-3, 68},  {-20, 81}, {0, 30},   {1, 7},    {-3, 23},  {-21, 74}, {16, 66}, {-23, 124}, {17, 37},  {44, -18}, {50, -34}, {-22, 127}},
};

/* @see Table 9-20 – Values of variables m and n for ctxIdx from 166 to 226. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_166_226[4][61][2] = {
    {{24, 0},   {15, 9},   {8, 25},   {13, 18},  {15, 9},   {13, 19},  {10, 37},  {12, 18},  {6, 29},   {20, 33}, {15, 30}, {4, 45},  {1, 58},  {0, 62},   {7, 61},   {12, 38},
     {11, 45},  {15, 39},  {11, 42},  {13, 44},  {16, 45},  {12, 41},  {10, 49},  {30, 34},  {18, 42},  {10, 55}, {17, 51}, {17, 46}, {0, 89},  {26, -19}, {22, -17}, {26, -17},
     {30, -25}, {28, -20}, {33, -23}, {37, -27}, {33, -23}, {40, -28}, {38, -17}, {33, -11}, {40, -15}, {41, -6}, {38, 1},  {41, 17}, {30, -6}, {27, 3},   {26, 22},  {37, -16},
     {35, -4},  {38, -8},  {38, -3},  {37, 3},   {38, 5},   {42, 0},   {35, 16},  {39, 22},  {14, 48},  {27, 37}, {21, 60}, {12, 68}, {2, 97}},
    {{11, 28}, {2, 40},  {3, 44},  {0, 49},  {0, 46},  {2, 44},  {2, 51},  {0, 47},  {4, 39},  {2, 62},  {6, 46},  {0, 54},  {3, 54},  {2, 58}, {4, 63},  {6, 51},
     {6, 57},  {7, 53},  {6, 52},  {6, 55},  {11, 45}, {14, 36}, {8, 53},  {-1, 82}, {7, 55},  {-3, 78}, {15, 46}, {22, 31}, {-1, 84}, {25, 7}, {30, -7}, {28, 3},
     {28, 4},  {32, 0},  {34, -1}, {30, 6},  {30, 6},  {32, 9},  {31, 19}, {26, 27}, {26, 30}, {37, 20}, {28, 34}, {17, 70}, {1, 67},  {5, 59}, {9, 67},  {16, 30},
     {18, 32}, {18, 35}, {22, 29}, {24, 31}, {23, 38}, {18, 43}, {20, 41}, {11, 63}, {9, 59},  {9, 64},  {-1, 94}, {-2, 89}, {-9, 108}},
    {{4, 45},  {10, 28},  {10, 31}, {33, -11}, {52, -43}, {18, 15},  {28, 0},   {35, -22}, {38, -25}, {34, 0},   {39, -18}, {32, -12}, {102, -94},
     {0, 0},   {56, -15}, {33, -4}, {29, 10},  {37, -5},  {51, -29}, {39, -9},  {52, -34}, {69, -58}, {67, -63}, {44, -5},  {32, 7},   {55, -29},
     {32, 1},  {0, 0},    {27, 36}, {33, -25}, {34, -30}, {36, -28}, {38, -28}, {38, -27}, {34, -18}, {35, -16}, {34, -14}, {32, -8},  {37, -6},
     {35, 0},  {30, 10},  {28, 18}, {26, 25},  {29, 41},  {0, 75},   {2, 72},   {8, 77},   {14, 35},  {18, 31},  {17, 35},  {21, 30},  {17, 45},
     {20, 42}, {18, 45},  {27, 26}, {16, 54},  {7, 66},   {16, 56},  {11, 73},  {10, 67},  {-10, 116}},
    {{4, 39},  {0, 42},  {7, 34},   {11, 29},  {8, 31},   {6, 37},  {7, 42},  {3, 40},  {8, 33},  {13, 43}, {13, 36}, {4, 47},  {3, 55},   {2, 58},   {6, 60},   {8, 44},
     {11, 44}, {14, 42}, {7, 48},   {4, 56},   {4, 52},   {13, 37}, {9, 49},  {19, 58}, {10, 48}, {12, 45}, {0, 69},  {20, 33}, {8, 63},   {35, -18}, {33, -25}, {28, -3},
     {24, 10}, {27, 0},  {34, -14}, {52, -44}, {39, -24}, {19, 17}, {31, 25}, {36, 29}, {24, 33}, {34, 15}, {30, 20}, {22, 73}, {20, 34},  {19, 31},  {27, 44},  {19, 16},
     {15, 36}, {15, 36}, {21, 28},  {25, 21},  {30, 20},  {31, 12}, {27, 16}, {24, 42}, {0, 93},  {14, 56}, {15, 57}, {26, 38}, {-24, 127}},
};

/* @see Table 9-21 – Values of variables m and n for ctxIdx from 227 to 275. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_227_275[4][49][2] = {
    {{-3, 71}, {-6, 42}, {-5, 50},  {-3, 54},   {-2, 62},  {0, 58},   {1, 63},   {-2, 72},  {-1, 74},  {-9, 91},  {-5, 67},  {-5, 27},  {-3, 39},
     {-2, 44}, {0, 46},  {-16, 64}, {-8, 68},   {-10, 78}, {-6, 77},  {-10, 86}, {-12, 92}, {-15, 55}, {-10, 60}, {-6, 62},  {-4, 65},  {-12, 73},
     {-8, 76}, {-7, 80}, {-9, 88},  {-17, 110}, {-11, 97}, {-20, 84}, {-11, 79}, {-6, 73},  {-4, 74},  {-13, 86}, {-13, 96}, {-11, 97}, {-19, 117},
     {-8, 78}, {-5, 33}, {-4, 48},  {-2, 53},   {-3, 62},  {-13, 71}, {-10, 79}, {-12, 86}, {-13, 90}, {-14, 97}},
    {{-6, 76}, {-2, 44}, {0, 45},  {0, 52},   {-3, 64},  {-2, 59},  {-4, 70},   {-4, 75}, {-8, 82}, {-17, 102}, {-9, 77}, {3, 24},  {0, 42},
     {0, 48},  {0, 55},  {-6, 59}, {-7, 71},  {-12, 83}, {-11, 87}, {-30, 119}, {1, 58},  {-3, 29}, {-1, 36},   {1, 38},  {2, 43},  {-6, 55},
     {0, 58},  {0, 64},  {-3, 74}, {-10, 90}, {0, 70},   {-4, 29},  {5, 31},    {7, 42},  {1, 59},  {-2, 58},   {-3, 72}, {-3, 81}, {-11, 97},
     {0, 58},  {8, 5},   {10, 14}, {14, 18},  {13, 27},  {2, 40},   {0, 58},    {-3, 70}, {-6, 79}, {-8, 85}},
    {{-23, 112}, {-15, 71}, {-7, 61},  {0, 53},   {-5, 66},   {-11, 77},  {-9, 80},   {-9, 84},  {-10, 87}, {-34, 127}, {-21, 101}, {-3, 39}, {-5, 53},
     {-7, 61},   {-11, 75}, {-15, 77}, {-17, 91}, {-25, 107}, {-25, 111}, {-28, 122}, {-11, 76}, {-10, 44}, {-10, 52},  {-10, 57},  {-9, 58}, {-16, 72},
     {-7, 69},   {-4, 69},  {-5, 74},  {-9, 86},  {2, 66},    {-9, 34},   {1, 32},    {11, 31},  {5, 52},   {-2, 55},   {-2, 67},   {0, 73},  {-8, 89},
     {3, 52},    {7, 4},    {10, 8},   {17, 8},   {16, 19},   {3, 37},    {-1, 61},   {-5, 73},  {-1, 70},  {-4, 78}},
    {{-24, 115}, {-22, 82}, {-9, 62},  {0, 53},    {0, 59},    {-14, 85}, {-13, 89},  {-13, 94}, {-11, 92}, {-29, 127}, {-21, 100}, {-14, 57}, {-12, 67},
     {-11, 71},  {-10, 77}, {-21, 85}, {-16, 88},  {-23, 104}, {-15, 98}, {-37, 127}, {-10, 82}, {-8, 48},  {-8, 61},   {-8, 66},   {-7, 70},  {-14, 75},
     {-10, 79},  {-9, 83},  {-12, 92}, {-18, 108}, {-4, 79},   {-22, 69}, {-16, 75},  {-2, 58},  {1, 58},   {-13, 78},  {-9, 83},   {-4, 81},  {-13, 99},
     {-13, 81},  {-6, 38},  {-13, 62}, {-6, 58},   {-2, 59},   {-16, 73}, {-10, 76},  {-13, 86}, {-9, 83},  {-10, 87}},
};

/* @see Table 9-22 – Values of variables m and n for ctxIdx from 277 to 337. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_277_337[4][61][2] = {
    {{-6, 93}, {-6, 84}, {-8, 79},  {0, 66},  {-1, 71},  {0, 62},   {-2, 60}, {-2, 59}, {-5, 75}, {-3, 62},  {-4, 58}, {-9, 66}, {-1, 79}, {0, 71},    {3, 68},   {10, 44},
     {-7, 62}, {15, 36}, {14, 40},  {16, 27}, {12, 29},  {1, 44},   {20, 36}, {18, 32}, {5, 42},  {1, 48},   {10, 62}, {17, 46}, {9, 64},  {-12, 104}, {-11, 97}, {-16, 96},
     {-7, 88}, {-8, 85}, {-7, 85},  {-9, 85}, {-13, 88}, {4, 66},   {-3, 77}, {-3, 76}, {-6, 76}, {10, 58},  {-1, 76}, {-1, 83}, {-7, 99}, {-14, 95},  {2, 95},   {0, 76},
     {-5, 74}, {0, 70},  {-11, 75}, {1, 68},  {0, 65},   {-14, 73}, {3, 62},  {4, 62},  {-1, 68}, {-13, 75}, {11, 55}, {5, 64},  {12, 70}},
    {{-13, 106}, {-16, 106}, {-10, 87}, {-21, 114}, {-18, 110}, {-14, 98}, {-22, 110}, {-21, 106}, {-18, 103}, {-21, 107}, {-23, 108}, {-26, 112}, {-10, 96},
     {-12, 95},  {-5, 91},   {-9, 93},  {-22, 94},  {-5, 86},   {9, 67},   {-4, 80},   {-10, 85},  {-1, 70},   {7, 60},    {9, 58},    {5, 61},    {12, 50},
     {15, 50},   {18, 49},   {17, 54},  {10, 41},   {7, 46},    {-1, 51},  {7, 49},    {8, 52},    {9, 41},    {6, 47},    {2, 55},    {13, 41},   {10, 44},
     {6, 50},    {5, 53},    {13, 49},  {4, 63},    {6, 64},    {-2, 69},  {-2, 59},   {6, 70},    {10, 44},   {9, 31},    {12, 43},   {3, 53},    {14, 34},
     {10, 38},   {-3, 52},   {13, 40},  {17, 32},   {7, 44},    {7, 38},   {13, 50},   {10, 57},   {26, 43}},
    {{-21, 126}, {-23, 124}, {-20, 110}, {-26, 126}, {-25, 124}, {-17, 105}, {-27, 121}, {-27, 117}, {-17, 102}, {-26, 117}, {-27, 116}, {-33, 122}, {-10, 95},
     {-14, 100}, {-8, 95},   {-17, 111}, {-28, 114}, {-6, 89},   {-2, 80},   {-4, 82},   {-9, 85},   {-8, 81},   {-1, 72},   {5, 64},    {1, 67},    {9, 56},
     {0, 69},    {1, 69},    {7, 69},    {-7, 69},   {-6, 67},   {-16, 77},  {-2, 64},   {2, 61},    {-6, 67},   {-3, 64},   {2, 57},    {-3, 65},   {-3, 66},
     {0, 62},    {9, 51},    {-1, 66},   {-2, 71},   {-2, 75},   {-1, 70},   {-9, 72},   {14, 60},   {16, 37},   {0, 47},    {18, 35},   {11, 37},   {12, 41},
     {10, 41},   {2, 48},    {12, 41},   {13, 41},   {0, 59},    {3, 50},    {19, 40},   {3, 66},    {18, 50}},
    {{-22, 127}, {-25, 127}, {-25, 120}, {-27, 127}, {-19, 114}, {-23, 117}, {-25, 118}, {-26, 117}, {-24, 113}, {-28, 118}, {-31, 120}, {-37, 124}, {-10, 94},
     {-15, 102}, {-10, 99},  {-13, 106}, {-50, 127}, {-5, 92},   {17, 57},   {-5, 86},   {-13, 94},  {-12, 91},  {-2, 77},   {0, 71},    {-1, 73},   {4, 64},
     {-7, 81},   {5, 64},    {15, 57},   {1, 67},    {0, 68},    {-10, 67},  {1, 68},    {0, 77},    {2, 64},    {0, 68},    {-5, 78},   {7, 55},    {5, 59},
     {2, 65},    {14, 54},   {15, 44},   {5, 60},    {2, 70},    {-2, 76},   {-18, 86},  {12, 70},   {5, 64},    {-12, 70},  {11, 55},   {5, 56},    {0, 69},
     {2, 65},    {-6, 74},   {5, 54},    {7, 54},    {-6, 76},   {-11, 82},  {-2, 77},   {-2, 77},   {25, 42}},
};

/* @see Table 9-23 – Values of variables m and n for ctxIdx from 338 to 398. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_338_398[4][61][2] = {
    {{15, 6},   {6, 19},   {7, 16},   {12, 14},  {18, 13},  {13, 11}, {13, 15}, {15, 16}, {12, 23}, {13, 23}, {15, 20}, {14, 26}, {14, 44},   {17, 40},  {17, 47},  {24, 17},
     {21, 21},  {25, 22},  {31, 27},  {22, 29},  {19, 35},  {14, 50}, {10, 57}, {7, 63},  {-2, 77}, {-4, 82}, {-3, 94}, {9, 69},  {-12, 109}, {36, -35}, {36, -34}, {32, -26},
     {37, -30}, {44, -32}, {34, -18}, {34, -15}, {40, -15}, {33, -7}, {35, -5}, {33, 0},  {38, 2},  {33, 13}, {23, 35}, {13, 58}, {29, -3},   {26, 0},   {22, 30},  {31, -7},
     {35, -15}, {34, -3},  {34, 3},   {36, -1},  {34, 5},   {32, 11}, {35, 5},  {34, 12}, {39, 11}, {30, 29}, {34, 26}, {29, 39}, {19, 66}},
    {{14, 11},  {11, 14},  {9, 11},   {18, 11},  {21, 9},   {23, -2}, {32, -15}, {32, -15}, {34, -21}, {39, -23}, {42, -33}, {41, -31}, {46, -28},  {38, -12}, {21, 29}, {45, -24},
     {53, -45}, {48, -26}, {65, -43}, {43, -19}, {39, -10}, {30, 9},  {18, 26},  {20, 27},  {0, 57},   {-14, 82}, {-5, 75},  {-19, 97}, {-35, 125}, {27, 0},   {28, 0},  {31, -4},
     {27, 6},   {34, 8},   {30, 10},  {24, 22},  {33, 19},  {22, 32}, {26, 31},  {21, 41},  {26, 44},  {23, 47},  {16, 65},  {14, 71},  {8, 60},    {6, 63},   {17, 65}, {21, 24},
     {23, 20},  {26, 23},  {27, 32},  {28, 23},  {28, 24},  {23, 40}, {24, 32},  {28, 29},  {23, 42},  {19, 57},  {22, 53},  {22, 61},  {11, 86}},
    {{19, -6},  {18, -6},  {14, 0},   {26, -12}, {31, -16}, {33, -25}, {33, -22}, {37, -28}, {39, -30}, {42, -30}, {47, -42}, {45, -36}, {49, -34}, {41, -17}, {32, 9},   {69, -71},
     {63, -63}, {66, -64}, {77, -74}, {54, -39}, {52, -35}, {41, -10}, {36, 0},   {40, -1},  {30, 14},  {28, 26},  {23, 37},  {12, 55},  {11, 65},  {37, -33}, {39, -36}, {40, -37},
     {38, -30}, {46, -33}, {42, -30}, {40, -24}, {49, -29}, {38, -12}, {40, -10}, {38, -3},  {46, -5},  {31, 20},  {29, 30},  {25, 44},  {12, 48},  {11, 49},  {26, 45},  {22, 22},
     {23, 22},  {27, 21},  {33, 20},  {26, 28},  {30, 24},  {27, 34},  {18, 42},  {25, 39},  {18, 50},  {12, 70},  {21, 54},  {14, 71},  {11, 83}},
    {{17, -13}, {16, -9}, {17, -12}, {27, -21}, {37, -30}, {41, -40},  {42, -41}, {48, -47}, {39, -32}, {46, -40}, {52, -51}, {46, -41}, {52, -39},
     {43, -19}, {32, 11}, {61, -55}, {56, -46}, {62, -50}, {81, -67},  {45, -20}, {35, -2},  {28, 15},  {34, 1},   {39, 1},   {30, 17},  {20, 38},
     {18, 45},  {15, 54}, {0, 79},   {36, -16}, {37, -14}, {37, -17},  {32, 1},   {34, 15},  {29, 15},  {24, 25},  {34, 22},  {31, 16},  {35, 18},
     {31, 28},  {33, 41}, {36, 28},  {27, 47},  {21, 62},  {18, 31},   {19, 26},  {36, 24},  {24, 23},  {27, 16},  {24, 30},  {31, 29},  {22, 41},
     {22, 42},  {16, 60}, {15, 52},  {14, 60},  {3, 78},   {-16, 123}, {21, 53},  {22, 56},  {25, 61}},
};

/* @see Table 9-24 – Values of variables m and n for ctxIdx from 402 to 459. the first dimension is I slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_402_459[4][58][2] = {
    {{-17, 120}, {-20, 112}, {-18, 114}, {-11, 85}, {-15, 92},  {-14, 89}, {-26, 71}, {-15, 81}, {-14, 80}, {0, 68},   {-14, 70}, {-24, 56}, {-23, 68}, {-24, 50}, {-11, 74},
     {23, -13},  {26, -13},  {40, -15},  {49, -14}, {44, 3},    {45, 6},   {44, 34},  {33, 54},  {19, 82},  {-3, 75},  {-1, 23},  {1, 34},   {1, 43},   {0, 54},   {-2, 55},
     {0, 61},    {1, 64},    {0, 68},    {-9, 92},  {-14, 106}, {-13, 97}, {-15, 90}, {-12, 90}, {-18, 88}, {-10, 73}, {-9, 79},  {-14, 86}, {-10, 73}, {-10, 70}, {-10, 69},
     {-5, 66},   {-9, 64},   {-5, 58},   {2, 59},   {21, -10},  {24, -11}, {28, -8},  {28, -1},  {29, 3},   {29, 9},   {35, 20},  {29, 36},  {14, 67}},
    {{-4, 79}, {-7, 71},  {-5, 69}, {-9, 70}, {-8, 66},  {-10, 68}, {-19, 73}, {-12, 69}, {-16, 70}, {-15, 67}, {-20, 62}, {-19, 70}, {-16, 66}, {-22, 65}, {-20, 63},
     {9, -2},  {26, -9},  {33, -9}, {39, -7}, {41, -2},  {45, 3},   {49, 9},   {45, 27},  {36, 59},  {-6, 66},  {-7, 35},  {-7, 42},  {-8, 45},  {-5, 48},  {-12, 56},
     {-6, 60}, {-5, 62},  {-8, 66}, {-8, 76}, {-5, 85},  {-6, 81},  {-10, 77}, {-7, 81},  {-17, 80}, {-18, 73}, {-4, 74},  {-10, 83}, {-9, 71},  {-9, 67},  {-1, 61},
     {-8, 66}, {-14, 66}, {0, 59},  {2, 59},  {21, -13}, {33, -14}, {39, -7},  {46, -2},  {51, 2},   {60, 6},   {61, 17},  {55, 34},  {42, 62}},
    {{-5, 85},  {-6, 81},  {-10, 77}, {-7, 81}, {-17, 80}, {-18, 73}, {-4, 74}, {-10, 83}, {-9, 71},  {-9, 67},  {-1, 61}, {-8, 66}, {-14, 66}, {0, 59},  {2, 59},
     {17, -10}, {32, -13}, {42, -9},  {49, -5}, {53, 0},   {64, 3},   {68, 10}, {66, 27},  {47, 57},  {-5, 71},  {0, 24},  {-1, 36}, {-2, 42},  {-2, 52}, {-9, 57},
     {-6, 63},  {-4, 65},  {-4, 67},  {-7, 82}, {-3, 81},  {-3, 76},  {-7, 72}, {-6, 78},  {-12, 72}, {-14, 68}, {-3, 70}, {-6, 76}, {-5, 66},  {-5, 62}, {0, 57},
     {-4, 61},  {-9, 60},  {1, 54},   {2, 58},  {17, -10}, {32, -13}, {42, -9}, {49, -5},  {53, 0},   {64, 3},   {68, 10}, {66, 27}, {47, 57}},
    {{-3, 78}, {-8, 74},  {-9, 72}, {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70},  {-17, 75}, {-14, 72}, {-16, 67}, {-8, 53}, {-14, 59}, {-9, 52},  {-11, 68},
     {9, -2},  {30, -10}, {31, -4}, {33, -1},  {33, 7},   {31, 12},  {37, 23},  {31, 38},  {20, 64},  {-9, 71},  {-7, 37},  {-8, 44}, {-11, 49}, {-10, 56}, {-12, 59},
     {-8, 63}, {-9, 67},  {-6, 68}, {-10, 79}, {-3, 78},  {-8, 74},  {-9, 72},  {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70}, {-17, 75}, {-14, 72}, {-16, 67},
     {-8, 53}, {-14, 59}, {-9, 52}, {-11, 68}, {9, -2},   {30, -10}, {31, -4},  {33, -1},  {33, 7},   {31, 12},  {37, 23},  {31, 38}, {20, 64}},
};

/* @see Table 9-25 – Values of variables m and n for ctxIdx from 460 to 483. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_460_483[4][24][2] = {
    {{-17, 123}, {-12, 115}, {-16, 122}, {-11, 115}, {-12, 63}, {-2, 68}, {-15, 84}, {-13, 104}, {-3, 70}, {-8, 93}, {-10, 90}, {-30, 127},
     {-17, 123}, {-12, 115}, {-16, 122}, {-11, 115}, {-12, 63}, {-2, 68}, {-15, 84}, {-13, 104}, {-3, 70}, {-8, 93}, {-10, 90}, {-30, 127}},
    {{-7, 92}, {-5, 89}, {-7, 96}, {-13, 108}, {-3, 46}, {-1, 65}, {-1, 57}, {-9, 93}, {-3, 74}, {-9, 92}, {-8, 87}, {-23, 126},
     {-7, 92}, {-5, 89}, {-7, 96}, {-13, 108}, {-3, 46}, {-1, 65}, {-1, 57}, {-9, 93}, {-3, 74}, {-9, 92}, {-8, 87}, {-23, 126}},
    {{0, 80}, {-5, 89}, {-7, 94}, {-4, 92}, {0, 39}, {0, 65}, {-15, 84}, {-35, 127}, {-2, 73}, {-12, 104}, {-9, 91}, {-31, 127},
     {0, 80}, {-5, 89}, {-7, 94}, {-4, 92}, {0, 39}, {0, 65}, {-15, 84}, {-35, 127}, {-2, 73}, {-12, 104}, {-9, 91}, {-31, 127}},
    {{11, 80}, {5, 76}, {2, 84}, {5, 78}, {-6, 55}, {4, 61}, {-14, 83}, {-37, 127}, {-5, 79}, {-11, 104}, {-11, 91}, {-30, 127},
     {11, 80}, {5, 76}, {2, 84}, {5, 78}, {-6, 55}, {4, 61}, {-14, 83}, {-37, 127}, {-5, 79}, {-11, 104}, {-11, 91}, {-30, 127}},
};

/* @see Table 9-26 – Values of variables m and n for ctxIdx from 484 to 571. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_484_571[4][88][2] = {
    {{-7, 93},   {-11, 87},  {-3, 77},  {-5, 71},  {-4, 63},  {-4, 68},  {-12, 84}, {-7, 62},  {-7, 65},  {8, 61},   {5, 56},  {-2, 66}, {1, 64},  {0, 61},    {-2, 78},
     {1, 50},    {7, 52},    {10, 35},  {0, 44},   {11, 38},  {1, 45},   {0, 46},   {5, 44},   {31, 17},  {1, 51},   {7, 50},  {28, 19}, {16, 33}, {14, 62},   {-13, 108},
     {-15, 100}, {-13, 101}, {-13, 91}, {-12, 94}, {-10, 88}, {-16, 84}, {-10, 86}, {-7, 83},  {-13, 87}, {-19, 94}, {1, 70},  {0, 72},  {-5, 74}, {18, 59},   {-7, 93},
     {-11, 87},  {-3, 77},   {-5, 71},  {-4, 63},  {-4, 68},  {-12, 84}, {-7, 62},  {-7, 65},  {8, 61},   {5, 56},   {-2, 66}, {1, 64},  {0, 61},  {-2, 78},   {1, 50},
     {7, 52},    {10, 35},   {0, 44},   {11, 38},  {1, 45},   {0, 46},   {5, 44},   {31, 17},  {1, 51},   {7, 50},   {28, 19}, {16, 33}, {14, 62}, {-13, 108}, {-15, 100},
     {-13, 101}, {-13, 91},  {-12, 94}, {-10, 88}, {-16, 84}, {-10, 86}, {-7, 83},  {-13, 87}, {-19, 94}, {1, 70},   {0, 72},  {-5, 74}, {18, 59}},
    {{-2, 85}, {-6, 78}, {-1, 75}, {-7, 77}, {2, 54},   {5, 50},   {-3, 68}, {1, 50},   {6, 42},   {-4, 81}, {1, 63},  {-4, 70}, {0, 67},   {2, 57},   {-2, 76},
     {11, 35}, {4, 64},  {1, 61},  {11, 35}, {18, 25},  {12, 24},  {13, 29}, {13, 36},  {-10, 93}, {-7, 73}, {-2, 73}, {13, 46}, {9, 49},   {-7, 100}, {9, 53},
     {2, 53},  {5, 53},  {-2, 61}, {0, 56},  {0, 56},   {-13, 63}, {-5, 60}, {-1, 62},  {4, 57},   {-6, 69}, {4, 57},  {14, 39}, {4, 51},   {13, 68},  {-2, 85},
     {-6, 78}, {-1, 75}, {-7, 77}, {2, 54},  {5, 50},   {-3, 68},  {1, 50},  {6, 42},   {-4, 81},  {1, 63},  {-4, 70}, {0, 67},  {2, 57},   {-2, 76},  {11, 35},
     {4, 64},  {1, 61},  {11, 35}, {18, 25}, {12, 24},  {13, 29},  {13, 36}, {-10, 93}, {-7, 73},  {-2, 73}, {13, 46}, {9, 49},  {-7, 100}, {9, 53},   {2, 53},
     {5, 53},  {-2, 61}, {0, 56},  {0, 56},  {-13, 63}, {-5, 60},  {-1, 62}, {4, 57},   {-6, 69},  {4, 57},  {14, 39}, {4, 51},  {13, 68}},
    {{-13, 103}, {-13, 91}, {-9, 89},  {-14, 92}, {-8, 76},  {-12, 87},  {-23, 110}, {-24, 105}, {-10, 78},  {-20, 112}, {-17, 99},  {-78, 127}, {-70, 127}, {-50, 127}, {-46, 127},
     {-4, 66},   {-5, 78},  {-4, 71},  {-8, 72},  {2, 59},   {-1, 55},   {-7, 70},   {-6, 75},   {-8, 89},   {-34, 119}, {-3, 75},   {32, 20},   {30, 22},   {-44, 127}, {0, 54},
     {-5, 61},   {0, 58},   {-1, 60},  {-3, 61},  {-8, 67},  {-25, 84},  {-14, 74},  {-5, 65},   {5, 52},    {2, 57},    {0, 61},    {-9, 69},   {-11, 70},  {18, 55},   {-13, 103},
     {-13, 91},  {-9, 89},  {-14, 92}, {-8, 76},  {-12, 87}, {-23, 110}, {-24, 105}, {-10, 78},  {-20, 112}, {-17, 99},  {-78, 127}, {-70, 127}, {-50, 127}, {-46, 127}, {-4, 66},
     {-5, 78},   {-4, 71},  {-8, 72},  {2, 59},   {-1, 55},  {-7, 70},   {-6, 75},   {-8, 89},   {-34, 119}, {-3, 75},   {32, 20},   {30, 22},   {-44, 127}, {0, 54},    {-5, 61},
     {0, 58},    {-1, 60},  {-3, 61},  {-8, 67},  {-25, 84}, {-14, 74},  {-5, 65},   {5, 52},    {2, 57},    {0, 61},    {-9, 69},   {-11, 70},  {18, 55}},
    {{-4, 86},  {-12, 88}, {-5, 82},  {-3, 72},  {-4, 67},  {-8, 72},  {-16, 89}, {-9, 69},  {-1, 59}, {5, 66},   {4, 57},   {-4, 71}, {-2, 71}, {2, 58},  {-1, 74},
     {-4, 44},  {-1, 69},  {0, 62},   {-7, 51},  {-4, 47},  {-6, 42},  {-3, 41},  {-6, 53},  {8, 76},  {-9, 78},  {-11, 83}, {9, 52},  {0, 67},  {-5, 90}, {1, 67},
     {-15, 72}, {-5, 75},  {-8, 80},  {-21, 83}, {-21, 64}, {-13, 31}, {-25, 64}, {-29, 94}, {9, 75},  {17, 63},  {-8, 74},  {-5, 35}, {-2, 27}, {13, 91}, {-4, 86},
     {-12, 88}, {-5, 82},  {-3, 72},  {-4, 67},  {-8, 72},  {-16, 89}, {-9, 69},  {-1, 59},  {5, 66},  {4, 57},   {-4, 71},  {-2, 71}, {2, 58},  {-1, 74}, {-4, 44},
     {-1, 69},  {0, 62},   {-7, 51},  {-4, 47},  {-6, 42},  {-3, 41},  {-6, 53},  {8, 76},   {-9, 78}, {-11, 83}, {9, 52},   {0, 67},  {-5, 90}, {1, 67},  {-15, 72},
     {-5, 75},  {-8, 80},  {-21, 83}, {-21, 64}, {-13, 31}, {-25, 64}, {-29, 94}, {9, 75},   {17, 63}, {-8, 74},  {-5, 35},  {-2, 27}, {13, 91}},
};

/* @see Table 9-27 – Values of variables m and n for ctxIdx from 572 to 659. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_572_659[4][88][2] = {
    {{24, 0},   {15, 9},   {8, 25},   {13, 18},  {15, 9},   {13, 19},  {10, 37},  {12, 18},  {6, 29},   {20, 33},  {15, 30},  {4, 45},  {1, 58},  {0, 62},   {7, 61},
     {12, 38},  {11, 45},  {15, 39},  {11, 42},  {13, 44},  {16, 45},  {12, 41},  {10, 49},  {30, 34},  {18, 42},  {10, 55},  {17, 51}, {17, 46}, {0, 89},   {26, -19},
     {22, -17}, {26, -17}, {30, -25}, {28, -20}, {33, -23}, {37, -27}, {33, -23}, {40, -28}, {38, -17}, {33, -11}, {40, -15}, {41, -6}, {38, 1},  {41, 17},  {24, 0},
     {15, 9},   {8, 25},   {13, 18},  {15, 9},   {13, 19},  {10, 37},  {12, 18},  {6, 29},   {20, 33},  {15, 30},  {4, 45},   {1, 58},  {0, 62},  {7, 61},   {12, 38},
     {11, 45},  {15, 39},  {11, 42},  {13, 44},  {16, 45},  {12, 41},  {10, 49},  {30, 34},  {18, 42},  {10, 55},  {17, 51},  {17, 46}, {0, 89},  {26, -19}, {22, -17},
     {26, -17}, {30, -25}, {28, -20}, {33, -23}, {37, -27}, {33, -23}, {40, -28}, {38, -17}, {33, -11}, {40, -15}, {41, -6},  {38, 1},  {41, 17}},
    {{11, 28}, {2, 40}, {3, 44}, {0, 49},  {0, 46},  {2, 44},  {2, 51},  {0, 47},  {4, 39},  {2, 62},  {6, 46},  {0, 54},  {3, 54},  {2, 58},  {4, 63},
     {6, 51},  {6, 57}, {7, 53}, {6, 52},  {6, 55},  {11, 45}, {14, 36}, {8, 53},  {-1, 82}, {7, 55},  {-3, 78}, {15, 46}, {22, 31}, {-1, 84}, {25, 7},
     {30, -7}, {28, 3}, {28, 4}, {32, 0},  {34, -1}, {30, 6},  {30, 6},  {32, 9},  {31, 19}, {26, 27}, {26, 30}, {37, 20}, {28, 34}, {17, 70}, {11, 28},
     {2, 40},  {3, 44}, {0, 49}, {0, 46},  {2, 44},  {2, 51},  {0, 47},  {4, 39},  {2, 62},  {6, 46},  {0, 54},  {3, 54},  {2, 58},  {4, 63},  {6, 51},
     {6, 57},  {7, 53}, {6, 52}, {6, 55},  {11, 45}, {14, 36}, {8, 53},  {-1, 82}, {7, 55},  {-3, 78}, {15, 46}, {22, 31}, {-1, 84}, {25, 7},  {30, -7},
     {28, 3},  {28, 4}, {32, 0}, {34, -1}, {30, 6},  {30, 6},  {32, 9},  {31, 19}, {26, 27}, {26, 30}, {37, 20}, {28, 34}, {17, 70}},
    {{4, 45},   {10, 28},  {10, 31},  {33, -11}, {52, -43}, {18, 15},  {28, 0},   {35, -22}, {38, -25}, {34, 0},   {39, -18}, {32, -12},  {102, -94}, {0, 0},    {56, -15},
     {33, -4},  {29, 10},  {37, -5},  {51, -29}, {39, -9},  {52, -34}, {69, -58}, {67, -63}, {44, -5},  {32, 7},   {55, -29}, {32, 1},    {0, 0},     {27, 36},  {33, -25},
     {34, -30}, {36, -28}, {38, -28}, {38, -27}, {34, -18}, {35, -16}, {34, -14}, {32, -8},  {37, -6},  {35, 0},   {30, 10},  {28, 18},   {26, 25},   {29, 41},  {4, 45},
     {10, 28},  {10, 31},  {33, -11}, {52, -43}, {18, 15},  {28, 0},   {35, -22}, {38, -25}, {34, 0},   {39, -18}, {32, -12}, {102, -94}, {0, 0},     {56, -15}, {33, -4},
     {29, 10},  {37, -5},  {51, -29}, {39, -9},  {52, -34}, {69, -58}, {67, -63}, {44, -5},  {32, 7},   {55, -29}, {32, 1},   {0, 0},     {27, 36},   {33, -25}, {34, -30},
     {36, -28}, {38, -28}, {38, -27}, {34, -18}, {35, -16}, {34, -14}, {32, -8},  {37, -6},  {35, 0},   {30, 10},  {28, 18},  {26, 25},   {29, 41}},
    {{4, 39},   {0, 42},  {7, 34},  {11, 29},  {8, 31},   {6, 37},   {7, 42},   {3, 40},  {8, 33},  {13, 43}, {13, 36}, {4, 47},  {3, 55},  {2, 58},   {6, 60},
     {8, 44},   {11, 44}, {14, 42}, {7, 48},   {4, 56},   {4, 52},   {13, 37},  {9, 49},  {19, 58}, {10, 48}, {12, 45}, {0, 69},  {20, 33}, {8, 63},   {35, -18},
     {33, -25}, {28, -3}, {24, 10}, {27, 0},   {34, -14}, {52, -44}, {39, -24}, {19, 17}, {31, 25}, {36, 29}, {24, 33}, {34, 15}, {30, 20}, {22, 73},  {4, 39},
     {0, 42},   {7, 34},  {11, 29}, {8, 31},   {6, 37},   {7, 42},   {3, 40},   {8, 33},  {13, 43}, {13, 36}, {4, 47},  {3, 55},  {2, 58},  {6, 60},   {8, 44},
     {11, 44},  {14, 42}, {7, 48},  {4, 56},   {4, 52},   {13, 37},  {9, 49},   {19, 58}, {10, 48}, {12, 45}, {0, 69},  {20, 33}, {8, 63},  {35, -18}, {33, -25},
     {28, -3},  {24, 10}, {27, 0},  {34, -14}, {52, -44}, {39, -24}, {19, 17},  {31, 25}, {36, 29}, {24, 33}, {34, 15}, {30, 20}, {22, 73}},
};

/* @see Table 9-28 – Values of variables m and n for ctxIdx from 660 to 717. the first dimension is I slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_660_717[4][58][2] = {
    {{-17, 120}, {-20, 112}, {-18, 114}, {-11, 85}, {-15, 92}, {-14, 89}, {-26, 71}, {-15, 81}, {-14, 80}, {0, 68},   {-14, 70}, {-24, 56}, {-23, 68}, {-24, 50}, {-11, 74},
     {-14, 106}, {-13, 97},  {-15, 90},  {-12, 90}, {-18, 88}, {-10, 73}, {-9, 79},  {-14, 86}, {-10, 73}, {-10, 70}, {-10, 69}, {-5, 66},  {-9, 64},  {-5, 58},  {2, 59},
     {23, -13},  {26, -13},  {40, -15},  {49, -14}, {44, 3},   {45, 6},   {44, 34},  {33, 54},  {19, 82},  {21, -10}, {24, -11}, {28, -8},  {28, -1},  {29, 3},   {29, 9},
     {35, 20},   {29, 36},   {14, 67},   {-3, 75},  {-1, 23},  {1, 34},   {1, 43},   {0, 54},   {-2, 55},  {0, 61},   {1, 64},   {0, 68},   {-9, 92}},
    {{-4, 79}, {-7, 71}, {-5, 69},  {-9, 70}, {-8, 66},  {-10, 68}, {-19, 73}, {-12, 69}, {-16, 70}, {-15, 67}, {-20, 62}, {-19, 70}, {-16, 66}, {-22, 65}, {-20, 63},
     {-5, 85}, {-6, 81}, {-10, 77}, {-7, 81}, {-17, 80}, {-18, 73}, {-4, 74},  {-10, 83}, {-9, 71},  {-9, 67},  {-1, 61},  {-8, 66},  {-14, 66}, {0, 59},   {2, 59},
     {9, -2},  {26, -9}, {33, -9},  {39, -7}, {41, -2},  {45, 3},   {49, 9},   {45, 27},  {36, 59},  {21, -13}, {33, -14}, {39, -7},  {46, -2},  {51, 2},   {60, 6},
     {61, 17}, {55, 34}, {42, 62},  {-6, 66}, {-7, 35},  {-7, 42},  {-8, 45},  {-5, 48},  {-12, 56}, {-6, 60},  {-5, 62},  {-8, 66},  {-8, 76}},
    {{-5, 85},  {-6, 81},  {-10, 77}, {-7, 81}, {-17, 80}, {-18, 73}, {-4, 74}, {-10, 83}, {-9, 71}, {-9, 67},  {-1, 61},  {-8, 66}, {-14, 66}, {0, 59}, {2, 59},
     {-3, 81},  {-3, 76},  {-7, 72},  {-6, 78}, {-12, 72}, {-14, 68}, {-3, 70}, {-6, 76},  {-5, 66}, {-5, 62},  {0, 57},   {-4, 61}, {-9, 60},  {1, 54}, {2, 58},
     {17, -10}, {32, -13}, {42, -9},  {49, -5}, {53, 0},   {64, 3},   {68, 10}, {66, 27},  {47, 57}, {17, -10}, {32, -13}, {42, -9}, {49, -5},  {53, 0}, {64, 3},
     {68, 10},  {66, 27},  {47, 57},  {-5, 71}, {0, 24},   {-1, 36},  {-2, 42}, {-2, 52},  {-9, 57}, {-6, 63},  {-4, 65},  {-4, 67}, {-7, 82}},
    {{-3, 78}, {-8, 74},  {-9, 72}, {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70},  {-17, 75}, {-14, 72}, {-16, 67}, {-8, 53}, {-14, 59}, {-9, 52}, {-11, 68},
     {-3, 78}, {-8, 74},  {-9, 72}, {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70},  {-17, 75}, {-14, 72}, {-16, 67}, {-8, 53}, {-14, 59}, {-9, 52}, {-11, 68},
     {9, -2},  {30, -10}, {31, -4}, {33, -1},  {33, 7},   {31, 12},  {37, 23},  {31, 38},  {20, 64},  {9, -2},   {30, -10}, {31, -4}, {33, -1},  {33, 7},  {31, 12},
     {37, 23}, {31, 38},  {20, 64}, {-9, 71},  {-7, 37},  {-8, 44},  {-11, 49}, {-10, 56}, {-12, 59}, {-8, 63},  {-9, 67},  {-6, 68}, {-10, 79}},
};

/* @see Table 9-29 – Values of variables m and n for ctxIdx from 718 to 775. the first dimension is I slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_718_775[4][58][2] = {
    {{-17, 120}, {-20, 112}, {-18, 114}, {-11, 85}, {-15, 92}, {-14, 89}, {-26, 71}, {-15, 81}, {-14, 80}, {0, 68},   {-14, 70}, {-24, 56}, {-23, 68}, {-24, 50}, {-11, 74},
     {-14, 106}, {-13, 97},  {-15, 90},  {-12, 90}, {-18, 88}, {-10, 73}, {-9, 79},  {-14, 86}, {-10, 73}, {-10, 70}, {-10, 69}, {-5, 66},  {-9, 64},  {-5, 58},  {2, 59},
     {23, -13},  {26, -13},  {40, -15},  {49, -14}, {44, 3},   {45, 6},   {44, 34},  {33, 54},  {19, 82},  {21, -10}, {24, -11}, {28, -8},  {28, -1},  {29, 3},   {29, 9},
     {35, 20},   {29, 36},   {14, 67},   {-3, 75},  {-1, 23},  {1, 34},   {1, 43},   {0, 54},   {-2, 55},  {0, 61},   {1, 64},   {0, 68},   {-9, 92}},
    {{-4, 79}, {-7, 71}, {-5, 69},  {-9, 70}, {-8, 66},  {-10, 68}, {-19, 73}, {-12, 69}, {-16, 70}, {-15, 67}, {-20, 62}, {-19, 70}, {-16, 66}, {-22, 65}, {-20, 63},
     {-5, 85}, {-6, 81}, {-10, 77}, {-7, 81}, {-17, 80}, {-18, 73}, {-4, 74},  {-10, 83}, {-9, 71},  {-9, 67},  {-1, 61},  {-8, 66},  {-14, 66}, {0, 59},   {2, 59},
     {9, -2},  {26, -9}, {33, -9},  {39, -7}, {41, -2},  {45, 3},   {49, 9},   {45, 27},  {36, 59},  {21, -13}, {33, -14}, {39, -7},  {46, -2},  {51, 2},   {60, 6},
     {61, 17}, {55, 34}, {42, 62},  {-6, 66}, {-7, 35},  {-7, 42},  {-8, 45},  {-5, 48},  {-12, 56}, {-6, 60},  {-5, 62},  {-8, 66},  {-8, 76}},
    {{-5, 85},  {-6, 81},  {-10, 77}, {-7, 81}, {-17, 80}, {-18, 73}, {-4, 74}, {-10, 83}, {-9, 71}, {-9, 67},  {-1, 61},  {-8, 66}, {-14, 66}, {0, 59}, {2, 59},
     {-3, 81},  {-3, 76},  {-7, 72},  {-6, 78}, {-12, 72}, {-14, 68}, {-3, 70}, {-6, 76},  {-5, 66}, {-5, 62},  {0, 57},   {-4, 61}, {-9, 60},  {1, 54}, {2, 58},
     {17, -10}, {32, -13}, {42, -9},  {49, -5}, {53, 0},   {64, 3},   {68, 10}, {66, 27},  {47, 57}, {17, -10}, {32, -13}, {42, -9}, {49, -5},  {53, 0}, {64, 3},
     {68, 10},  {66, 27},  {47, 57},  {-5, 71}, {0, 24},   {-1, 36},  {-2, 42}, {-2, 52},  {-9, 57}, {-6, 63},  {-4, 65},  {-4, 67}, {-7, 82}},
    {{-3, 78}, {-8, 74},  {-9, 72}, {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70},  {-17, 75}, {-14, 72}, {-16, 67}, {-8, 53}, {-14, 59}, {-9, 52}, {-11, 68},
     {-3, 78}, {-8, 74},  {-9, 72}, {-10, 72}, {-18, 75}, {-12, 71}, {-11, 63}, {-5, 70},  {-17, 75}, {-14, 72}, {-16, 67}, {-8, 53}, {-14, 59}, {-9, 52}, {-11, 68},
     {9, -2},  {30, -10}, {31, -4}, {33, -1},  {33, 7},   {31, 12},  {37, 23},  {31, 38},  {20, 64},  {9, -2},   {30, -10}, {31, -4}, {33, -1},  {33, 7},  {31, 12},
     {37, 23}, {31, 38},  {20, 64}, {-9, 71},  {-7, 37},  {-8, 44},  {-11, 49}, {-10, 56}, {-12, 59}, {-8, 63},  {-9, 67},  {-6, 68}, {-10, 79}},
};

/* @see Table 9-30 – Values of variables m and n for ctxIdx from 776 to 863. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_776_863[4][88][2] = {
    {{-6, 93},  {-6, 84},  {-8, 79}, {0, 66},  {-1, 71}, {0, 62},   {-2, 60},  {-2, 59}, {-5, 75}, {-3, 62}, {-4, 58}, {-9, 66}, {-1, 79}, {0, 71},    {3, 68},
     {10, 44},  {-7, 62},  {15, 36}, {14, 40}, {16, 27}, {12, 29},  {1, 44},   {20, 36}, {18, 32}, {5, 42},  {1, 48},  {10, 62}, {17, 46}, {9, 64},    {-12, 104},
     {-11, 97}, {-16, 96}, {-7, 88}, {-8, 85}, {-7, 85}, {-9, 85},  {-13, 88}, {4, 66},  {-3, 77}, {-3, 76}, {-6, 76}, {10, 58}, {-1, 76}, {-1, 83},   {-6, 93},
     {-6, 84},  {-8, 79},  {0, 66},  {-1, 71}, {0, 62},  {-2, 60},  {-2, 59},  {-5, 75}, {-3, 62}, {-4, 58}, {-9, 66}, {-1, 79}, {0, 71},  {3, 68},    {10, 44},
     {-7, 62},  {15, 36},  {14, 40}, {16, 27}, {12, 29}, {1, 44},   {20, 36},  {18, 32}, {5, 42},  {1, 48},  {10, 62}, {17, 46}, {9, 64},  {-12, 104}, {-11, 97},
     {-16, 96}, {-7, 88},  {-8, 85}, {-7, 85}, {-9, 85}, {-13, 88}, {4, 66},   {-3, 77}, {-3, 76}, {-6, 76}, {10, 58}, {-1, 76}, {-1, 83}},
    {{-13, 106}, {-16, 106}, {-10, 87},  {-21, 114}, {-18, 110}, {-14, 98},  {-22, 110}, {-21, 106}, {-18, 103}, {-21, 107}, {-23, 108}, {-26, 112}, {-10, 96},
     {-12, 95},  {-5, 91},   {-9, 93},   {-22, 94},  {-5, 86},   {9, 67},    {-4, 80},   {-10, 85},  {-1, 70},   {7, 60},    {9, 58},    {5, 61},    {12, 50},
     {15, 50},   {18, 49},   {17, 54},   {10, 41},   {7, 46},    {-1, 51},   {7, 49},    {8, 52},    {9, 41},    {6, 47},    {2, 55},    {13, 41},   {10, 44},
     {6, 50},    {5, 53},    {13, 49},   {4, 63},    {6, 64},    {-13, 106}, {-16, 106}, {-10, 87},  {-21, 114}, {-18, 110}, {-14, 98},  {-22, 110}, {-21, 106},
     {-18, 103}, {-21, 107}, {-23, 108}, {-26, 112}, {-10, 96},  {-12, 95},  {-5, 91},   {-9, 93},   {-22, 94},  {-5, 86},   {9, 67},    {-4, 80},   {-10, 85},
     {-1, 70},   {7, 60},    {9, 58},    {5, 61},    {12, 50},   {15, 50},   {18, 49},   {17, 54},   {10, 41},   {7, 46},    {-1, 51},   {7, 49},    {8, 52},
     {9, 41},    {6, 47},    {2, 55},    {13, 41},   {10, 44},   {6, 50},    {5, 53},    {13, 49},   {4, 63},    {6, 64}},
    {{-21, 126}, {-23, 124}, {-20, 110}, {-26, 126}, {-25, 124}, {-17, 105}, {-27, 121}, {-27, 117}, {-17, 102}, {-26, 117}, {-27, 116}, {-33, 122}, {-10, 95},
     {-14, 100}, {-8, 95},   {-17, 111}, {-28, 114}, {-6, 89},   {-2, 80},   {-4, 82},   {-9, 85},   {-8, 81},   {-1, 72},   {5, 64},    {1, 67},    {9, 56},
     {0, 69},    {1, 69},    {7, 69},    {-7, 69},   {-6, 67},   {-16, 77},  {-2, 64},   {2, 61},    {-6, 67},   {-3, 64},   {2, 57},    {-3, 65},   {-3, 66},
     {0, 62},    {9, 51},    {-1, 66},   {-2, 71},   {-2, 75},   {-21, 126}, {-23, 124}, {-20, 110}, {-26, 126}, {-25, 124}, {-17, 105}, {-27, 121}, {-27, 117},
     {-17, 102}, {-26, 117}, {-27, 116}, {-33, 122}, {-10, 95},  {-14, 100}, {-8, 95},   {-17, 111}, {-28, 114}, {-6, 89},   {-2, 80},   {-4, 82},   {-9, 85},
     {-8, 81},   {-1, 72},   {5, 64},    {1, 67},    {9, 56},    {0, 69},    {1, 69},    {7, 69},    {-7, 69},   {-6, 67},   {-16, 77},  {-2, 64},   {2, 61},
     {-6, 67},   {-3, 64},   {2, 57},    {-3, 65},   {-3, 66},   {0, 62},    {9, 51},    {-1, 66},   {-2, 71},   {-2, 75}},
    {{-22, 127}, {-25, 127}, {-25, 120}, {-27, 127}, {-19, 114}, {-23, 117}, {-25, 118}, {-26, 117}, {-24, 113}, {-28, 118}, {-31, 120}, {-37, 124}, {-10, 94},
     {-15, 102}, {-10, 99},  {-13, 106}, {-50, 127}, {-5, 92},   {17, 57},   {-5, 86},   {-13, 94},  {-12, 91},  {-2, 77},   {0, 71},    {-1, 73},   {4, 64},
     {-7, 81},   {5, 64},    {15, 57},   {1, 67},    {0, 68},    {-10, 67},  {1, 68},    {0, 77},    {2, 64},    {0, 68},    {-5, 78},   {7, 55},    {5, 59},
     {2, 65},    {14, 54},   {15, 44},   {5, 60},    {2, 70},    {-22, 127}, {-25, 127}, {-25, 120}, {-27, 127}, {-19, 114}, {-23, 117}, {-25, 118}, {-26, 117},
     {-24, 113}, {-28, 118}, {-31, 120}, {-37, 124}, {-10, 94},  {-15, 102}, {-10, 99},  {-13, 106}, {-50, 127}, {-5, 92},   {17, 57},   {-5, 86},   {-13, 94},
     {-12, 91},  {-2, 77},   {0, 71},    {-1, 73},   {4, 64},    {-7, 81},   {5, 64},    {15, 57},   {1, 67},    {0, 68},    {-10, 67},  {1, 68},    {0, 77},
     {2, 64},    {0, 68},    {-5, 78},   {7, 55},    {5, 59},    {2, 65},    {14, 54},   {15, 44},   {5, 60},    {2, 70}},
};

/* @see Table 9-31 – Values of variables m and n for ctxIdx from 864 to 951. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_864_951[4][88][2] = {
    {{15, 6},   {6, 19},   {7, 16},   {12, 14},  {18, 13},  {13, 11},  {13, 15},  {15, 16}, {12, 23}, {13, 23}, {15, 20}, {14, 26}, {14, 44},   {17, 40},   {17, 47},
     {24, 17},  {21, 21},  {25, 22},  {31, 27},  {22, 29},  {19, 35},  {14, 50},  {10, 57}, {7, 63},  {-2, 77}, {-4, 82}, {-3, 94}, {9, 69},    {-12, 109}, {36, -35},
     {36, -34}, {32, -26}, {37, -30}, {44, -32}, {34, -18}, {34, -15}, {40, -15}, {33, -7}, {35, -5}, {33, 0},  {38, 2},  {33, 13}, {23, 35},   {13, 58},   {15, 6},
     {6, 19},   {7, 16},   {12, 14},  {18, 13},  {13, 11},  {13, 15},  {15, 16},  {12, 23}, {13, 23}, {15, 20}, {14, 26}, {14, 44}, {17, 40},   {17, 47},   {24, 17},
     {21, 21},  {25, 22},  {31, 27},  {22, 29},  {19, 35},  {14, 50},  {10, 57},  {7, 63},  {-2, 77}, {-4, 82}, {-3, 94}, {9, 69},  {-12, 109}, {36, -35},  {36, -34},
     {32, -26}, {37, -30}, {44, -32}, {34, -18}, {34, -15}, {40, -15}, {33, -7},  {35, -5}, {33, 0},  {38, 2},  {33, 13}, {23, 35}, {13, 58}},
    {{14, 11},  {11, 14},  {9, 11},   {18, 11},  {21, 9},   {23, -2},  {32, -15}, {32, -15}, {34, -21}, {39, -23}, {42, -33}, {41, -31}, {46, -28},  {38, -12},  {21, 29},
     {45, -24}, {53, -45}, {48, -26}, {65, -43}, {43, -19}, {39, -10}, {30, 9},   {18, 26},  {20, 27},  {0, 57},   {-14, 82}, {-5, 75},  {-19, 97},  {-35, 125}, {27, 0},
     {28, 0},   {31, -4},  {27, 6},   {34, 8},   {30, 10},  {24, 22},  {33, 19},  {22, 32},  {26, 31},  {21, 41},  {26, 44},  {23, 47},  {16, 65},   {14, 71},   {14, 11},
     {11, 14},  {9, 11},   {18, 11},  {21, 9},   {23, -2},  {32, -15}, {32, -15}, {34, -21}, {39, -23}, {42, -33}, {41, -31}, {46, -28}, {38, -12},  {21, 29},   {45, -24},
     {53, -45}, {48, -26}, {65, -43}, {43, -19}, {39, -10}, {30, 9},   {18, 26},  {20, 27},  {0, 57},   {-14, 82}, {-5, 75},  {-19, 97}, {-35, 125}, {27, 0},    {28, 0},
     {31, -4},  {27, 6},   {34, 8},   {30, 10},  {24, 22},  {33, 19},  {22, 32},  {26, 31},  {21, 41},  {26, 44},  {23, 47},  {16, 65},  {14, 71}},
    {{19, -6},  {18, -6},  {14, 0},   {26, -12}, {31, -16}, {33, -25}, {33, -22}, {37, -28}, {39, -30}, {42, -30}, {47, -42}, {45, -36}, {49, -34}, {41, -17}, {32, 9},
     {69, -71}, {63, -63}, {66, -64}, {77, -74}, {54, -39}, {52, -35}, {41, -10}, {36, 0},   {40, -1},  {30, 14},  {28, 26},  {23, 37},  {12, 55},  {11, 65},  {37, -33},
     {39, -36}, {40, -37}, {38, -30}, {46, -33}, {42, -30}, {40, -24}, {49, -29}, {38, -12}, {40, -10}, {38, -3},  {46, -5},  {31, 20},  {29, 30},  {25, 44},  {19, -6},
     {18, -6},  {14, 0},   {26, -12}, {31, -16}, {33, -25}, {33, -22}, {37, -28}, {39, -30}, {42, -30}, {47, -42}, {45, -36}, {49, -34}, {41, -17}, {32, 9},   {69, -71},
     {63, -63}, {66, -64}, {77, -74}, {54, -39}, {52, -35}, {41, -10}, {36, 0},   {40, -1},  {30, 14},  {28, 26},  {23, 37},  {12, 55},  {11, 65},  {37, -33}, {39, -36},
     {40, -37}, {38, -30}, {46, -33}, {42, -30}, {40, -24}, {49, -29}, {38, -12}, {40, -10}, {38, -3},  {46, -5},  {31, 20},  {29, 30},  {25, 44}},
    {{17, -13}, {16, -9},  {17, -12}, {27, -21}, {37, -30}, {41, -40}, {42, -41}, {48, -47}, {39, -32}, {46, -40}, {52, -51}, {46, -41}, {52, -39}, {43, -19}, {32, 11},
     {61, -55}, {56, -46}, {62, -50}, {81, -67}, {45, -20}, {35, -2},  {28, 15},  {34, 1},   {39, 1},   {30, 17},  {20, 38},  {18, 45},  {15, 54},  {0, 79},   {36, -16},
     {37, -14}, {37, -17}, {32, 1},   {34, 15},  {29, 15},  {24, 25},  {34, 22},  {31, 16},  {35, 18},  {31, 28},  {33, 41},  {36, 28},  {27, 47},  {21, 62},  {17, -13},
     {16, -9},  {17, -12}, {27, -21}, {37, -30}, {41, -40}, {42, -41}, {48, -47}, {39, -32}, {46, -40}, {52, -51}, {46, -41}, {52, -39}, {43, -19}, {32, 11},  {61, -55},
     {56, -46}, {62, -50}, {81, -67}, {45, -20}, {35, -2},  {28, 15},  {34, 1},   {39, 1},   {30, 17},  {20, 38},  {18, 45},  {15, 54},  {0, 79},   {36, -16}, {37, -14},
     {37, -17}, {32, 1},   {34, 15},  {29, 15},  {24, 25},  {34, 22},  {31, 16},  {35, 18},  {31, 28},  {33, 41},  {36, 28},  {27, 47},  {21, 62}},
};

/* @see Table 9-32 – Values of variables m and n for ctxIdx from 952 to 1011. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_952_1011[4][60][2] = {
    {{-3, 71},  {-6, 42}, {-5, 50},  {-3, 54}, {-2, 62},  {0, 58},   {1, 63},   {-2, 72},  {-1, 74}, {-9, 91}, {-5, 67},  {-5, 27}, {-3, 39}, {-2, 44}, {0, 46},
     {-16, 64}, {-8, 68}, {-10, 78}, {-6, 77}, {-10, 86}, {-12, 92}, {-15, 55}, {-10, 60}, {-6, 62}, {-4, 65}, {-12, 73}, {-8, 76}, {-7, 80}, {-9, 88}, {-17, 110},
     {-3, 71},  {-6, 42}, {-5, 50},  {-3, 54}, {-2, 62},  {0, 58},   {1, 63},   {-2, 72},  {-1, 74}, {-9, 91}, {-5, 67},  {-5, 27}, {-3, 39}, {-2, 44}, {0, 46},
     {-16, 64}, {-8, 68}, {-10, 78}, {-6, 77}, {-10, 86}, {-12, 92}, {-15, 55}, {-10, 60}, {-6, 62}, {-4, 65}, {-12, 73}, {-8, 76}, {-7, 80}, {-9, 88}, {-17, 110}},
    {{-6, 76}, {-2, 44}, {0, 45},   {0, 52},   {-3, 64},   {-2, 59}, {-4, 70}, {-4, 75}, {-8, 82}, {-17, 102}, {-9, 77}, {3, 24}, {0, 42}, {0, 48},  {0, 55},
     {-6, 59}, {-7, 71}, {-12, 83}, {-11, 87}, {-30, 119}, {1, 58},  {-3, 29}, {-1, 36}, {1, 38},  {2, 43},    {-6, 55}, {0, 58}, {0, 64}, {-3, 74}, {-10, 90},
     {-6, 76}, {-2, 44}, {0, 45},   {0, 52},   {-3, 64},   {-2, 59}, {-4, 70}, {-4, 75}, {-8, 82}, {-17, 102}, {-9, 77}, {3, 24}, {0, 42}, {0, 48},  {0, 55},
     {-6, 59}, {-7, 71}, {-12, 83}, {-11, 87}, {-30, 119}, {1, 58},  {-3, 29}, {-1, 36}, {1, 38},  {2, 43},    {-6, 55}, {0, 58}, {0, 64}, {-3, 74}, {-10, 90}},
    {{-23, 112}, {-15, 71}, {-7, 61},   {0, 53},    {-5, 66},   {-11, 77}, {-9, 80},  {-9, 84},  {-10, 87}, {-34, 127}, {-21, 101}, {-3, 39}, {-5, 53}, {-7, 61}, {-11, 75},
     {-15, 77},  {-17, 91}, {-25, 107}, {-25, 111}, {-28, 122}, {-11, 76}, {-10, 44}, {-10, 52}, {-10, 57}, {-9, 58},   {-16, 72},  {-7, 69}, {-4, 69}, {-5, 74}, {-9, 86},
     {-23, 112}, {-15, 71}, {-7, 61},   {0, 53},    {-5, 66},   {-11, 77}, {-9, 80},  {-9, 84},  {-10, 87}, {-34, 127}, {-21, 101}, {-3, 39}, {-5, 53}, {-7, 61}, {-11, 75},
     {-15, 77},  {-17, 91}, {-25, 107}, {-25, 111}, {-28, 122}, {-11, 76}, {-10, 44}, {-10, 52}, {-10, 57}, {-9, 58},   {-16, 72},  {-7, 69}, {-4, 69}, {-5, 74}, {-9, 86}},
    {{-24, 115}, {-22, 82}, {-9, 62},   {0, 53},   {0, 59},    {-14, 85}, {-13, 89}, {-13, 94}, {-11, 92}, {-29, 127}, {-21, 100}, {-14, 57}, {-12, 67}, {-11, 71}, {-10, 77},
     {-21, 85},  {-16, 88}, {-23, 104}, {-15, 98}, {-37, 127}, {-10, 82}, {-8, 48},  {-8, 61},  {-8, 66},  {-7, 70},   {-14, 75},  {-10, 79}, {-9, 83},  {-12, 92}, {-18, 108},
     {-24, 115}, {-22, 82}, {-9, 62},   {0, 53},   {0, 59},    {-14, 85}, {-13, 89}, {-13, 94}, {-11, 92}, {-29, 127}, {-21, 100}, {-14, 57}, {-12, 67}, {-11, 71}, {-10, 77},
     {-21, 85},  {-16, 88}, {-23, 104}, {-15, 98}, {-37, 127}, {-10, 82}, {-8, 48},  {-8, 61},  {-8, 66},  {-7, 70},   {-14, 75},  {-10, 79}, {-9, 83},  {-12, 92}, {-18, 108}},
};

/* @see Table 9-33 – Values of variables m and n for ctxIdx from 1012 to 1023. the first dimension is I and SI slices(0) and the cabac_init_idc(1,2,3) */
static const int8_t mn_1012_1023[4][12][2] = {
    {{-3, 70}, {-8, 93}, {-10, 90}, {-30, 127}, {-3, 70}, {-8, 93}, {-10, 90}, {-30, 127}, {-3, 70}, {-8, 93}, {-10, 90}, {-30, 127}},
    {{-3, 74}, {-9, 92}, {-8, 87}, {-23, 126}, {-3, 74}, {-9, 92}, {-8, 87}, {-23, 126}, {-3, 74}, {-9, 92}, {-8, 87}, {-23, 126}},
    {{-2, 73}, {-12, 104}, {-9, 91}, {-31, 127}, {-2, 73}, {-12, 104}, {-9, 91}, {-31, 127}, {-2, 73}, {-12, 104}, {-9, 91}, {-31, 127}},
    {{-5, 79}, {-11, 104}, {-11, 91}, {-30, 127}, {-5, 79}, {-11, 104}, {-11, 91}, {-30, 127}, {-5, 79}, {-11, 104}, {-11, 91}, {-30, 127}},
};

/* @see Table 9-44 – Specification of rangeTabLPS depending on pStateIdx and qCodIRangeIdx */
static const int32_t rangeTabLPS[64][4] = {
    {128, 176, 208, 240}, {128, 167, 197, 227}, {128, 158, 187, 216}, {123, 150, 178, 205}, {116, 142, 169, 195}, {111, 135, 160, 185}, {105, 128, 152, 175}, {100, 122, 144, 166},
    {95, 116, 137, 158},  {90, 110, 130, 150},  {85, 104, 123, 142},  {81, 99, 117, 135},   {77, 94, 111, 128},   {73, 89, 105, 122},   {69, 85, 100, 116},   {66, 80, 95, 110},
    {62, 76, 90, 104},    {59, 72, 86, 99},     {56, 69, 81, 94},     {53, 65, 77, 89},     {51, 62, 73, 85},     {48, 59, 69, 80},     {46, 56, 66, 76},     {43, 53, 63, 72},
    {41, 50, 59, 69},     {39, 48, 56, 65},     {37, 45, 54, 62},     {35, 43, 51, 59},     {33, 41, 48, 56},     {32, 39, 46, 53},     {30, 37, 43, 50},     {29, 35, 41, 48},
    {27, 33, 39, 45},     {26, 31, 37, 43},     {24, 30, 35, 41},     {23, 28, 33, 39},     {22, 27, 32, 37},     {21, 26, 30, 35},     {20, 24, 29, 33},     {19, 23, 27, 31},
    {18, 22, 26, 30},     {17, 21, 25, 28},     {16, 20, 23, 27},     {15, 19, 22, 25},     {14, 18, 21, 24},     {14, 17, 20, 23},     {13, 16, 19, 22},     {12, 15, 18, 21},
    {12, 14, 17, 20},     {11, 14, 16, 19},     {11, 13, 15, 18},     {10, 12, 15, 17},     {10, 12, 14, 16},     {9, 11, 13, 15},      {9, 11, 12, 14},      {8, 10, 12, 14},
    {8, 9, 11, 13},       {7, 9, 11, 12},       {7, 9, 10, 12},       {7, 8, 10, 11},       {6, 8, 9, 11},        {6, 7, 9, 10},        {6, 7, 8, 9},         {2, 2, 2, 2},
};

/* @see Table 9-45 – State transition table*/
static const int32_t transIdxLPS[64] = {0,  0,  1,  2,  2,  4,  4,  5,  6,  7,  8,  9,  9,  11, 11, 12, 13, 13, 15, 15, 16, 16, 18, 18, 19, 19, 21, 21, 22, 22, 23, 24,
                                        24, 25, 26, 26, 27, 27, 28, 29, 29, 30, 30, 30, 31, 32, 32, 33, 33, 33, 34, 34, 35, 35, 35, 36, 36, 36, 37, 37, 37, 38, 38, 63};

/* @see Table 9-45 – State transition table*/
static const int32_t transIdxMPS[64] = {1,  2,  3,  4,  5,  6,  7,  8,  9,  10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32,
                                        33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 62, 63};

static CABAC g_cabac_instance;

CABAC* get_singleton_cabac() { return &g_cabac_instance; }

int cabac_retrieve_m_n(int32_t ctxIdx, uint32_t slice_type, uint32_t cabac_init_idc, int8_t* m_out, int8_t* n_out) {
    if (ctxIdx < 0 || ctxIdx >= H264_MAX_CONTEXT_INDEX) {
        return ERR_INVALID_CABAC_CONTEXT_INDEX;
    }

    int32_t is_slice_type_i = (slice_type % 5 == 2);
    int32_t is_slice_type_si = (slice_type % 5 == 4);

    if (ctxIdx >= 0 && ctxIdx <= 10) {
        *m_out = mn_0_10[ctxIdx][0];
        *n_out = mn_0_10[ctxIdx][1];
    } else if (ctxIdx >= 11 && ctxIdx <= 23) {
        *m_out = mn_11_23[cabac_init_idc][ctxIdx - 11][0];
        *n_out = mn_11_23[cabac_init_idc][ctxIdx - 11][1];
    } else if (ctxIdx >= 24 && ctxIdx <= 39) {
        *m_out = mn_24_39[cabac_init_idc][ctxIdx - 24][0];
        *n_out = mn_24_39[cabac_init_idc][ctxIdx - 24][1];
    } else if (ctxIdx >= 40 && ctxIdx <= 53) {
        *m_out = mn_40_53[cabac_init_idc][ctxIdx - 40][0];
        *n_out = mn_40_53[cabac_init_idc][ctxIdx - 40][1];
    } else if (ctxIdx >= 54 && ctxIdx <= 59) {
        *m_out = mn_54_59[cabac_init_idc][ctxIdx - 54][0];
        *n_out = mn_54_59[cabac_init_idc][ctxIdx - 54][1];
    } else if (ctxIdx >= 60 && ctxIdx <= 69) {
        *m_out = mn_60_69[ctxIdx - 60][0];
        *n_out = mn_60_69[ctxIdx - 60][1];
    } else if (ctxIdx >= 70 && ctxIdx <= 104) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_70_104[0][ctxIdx - 70][0];
            *n_out = mn_70_104[0][ctxIdx - 70][1];
        } else {
            *m_out = mn_70_104[cabac_init_idc + 1][ctxIdx - 70][0];
            *n_out = mn_70_104[cabac_init_idc + 1][ctxIdx - 70][1];
        }
    } else if (ctxIdx >= 105 && ctxIdx <= 165) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_105_165[0][ctxIdx - 105][0];
            *n_out = mn_105_165[0][ctxIdx - 105][1];
        } else {
            *m_out = mn_105_165[cabac_init_idc + 1][ctxIdx - 105][0];
            *n_out = mn_105_165[cabac_init_idc + 1][ctxIdx - 105][1];
        }
    } else if (ctxIdx >= 166 && ctxIdx <= 226) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_166_226[0][ctxIdx - 166][0];
            *n_out = mn_166_226[0][ctxIdx - 166][1];
        } else {
            *m_out = mn_166_226[cabac_init_idc + 1][ctxIdx - 166][0];
            *n_out = mn_166_226[cabac_init_idc + 1][ctxIdx - 166][1];
        }
    } else if (ctxIdx >= 227 && ctxIdx <= 275) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_227_275[0][ctxIdx - 227][0];
            *n_out = mn_227_275[0][ctxIdx - 227][1];
        } else {
            *m_out = mn_227_275[cabac_init_idc + 1][ctxIdx - 227][0];
            *n_out = mn_227_275[cabac_init_idc + 1][ctxIdx - 227][1];
        }
    } else if (ctxIdx >= 277 && ctxIdx <= 337) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_277_337[0][ctxIdx - 277][0];
            *n_out = mn_277_337[0][ctxIdx - 277][1];
        } else {
            *m_out = mn_277_337[cabac_init_idc + 1][ctxIdx - 277][0];
            *n_out = mn_277_337[cabac_init_idc + 1][ctxIdx - 277][1];
        }
    } else if (ctxIdx >= 338 && ctxIdx <= 398) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_338_398[0][ctxIdx - 338][0];
            *n_out = mn_338_398[0][ctxIdx - 338][1];
        } else {
            *m_out = mn_338_398[cabac_init_idc + 1][ctxIdx - 338][0];
            *n_out = mn_338_398[cabac_init_idc + 1][ctxIdx - 338][1];
        }
    } else if (ctxIdx >= 399 && ctxIdx <= 401) {
        if (is_slice_type_i) {
            *m_out = mn_399_401[0][ctxIdx - 399][0];
            *n_out = mn_399_401[0][ctxIdx - 399][1];
        } else {
            *m_out = mn_399_401[cabac_init_idc + 1][ctxIdx - 399][0];
            *n_out = mn_399_401[cabac_init_idc + 1][ctxIdx - 399][1];
        }
    } else if (ctxIdx >= 402 && ctxIdx <= 459) {
        if (is_slice_type_i) {
            *m_out = mn_402_459[0][ctxIdx - 402][0];
            *n_out = mn_402_459[0][ctxIdx - 402][1];
        } else {
            *m_out = mn_402_459[cabac_init_idc + 1][ctxIdx - 402][0];
            *n_out = mn_402_459[cabac_init_idc + 1][ctxIdx - 402][1];
        }
    } else if (ctxIdx >= 460 && ctxIdx <= 483) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_460_483[0][ctxIdx - 460][0];
            *n_out = mn_460_483[0][ctxIdx - 460][1];
        } else {
            *m_out = mn_460_483[cabac_init_idc + 1][ctxIdx - 460][0];
            *n_out = mn_460_483[cabac_init_idc + 1][ctxIdx - 460][1];
        }
    } else if (ctxIdx >= 484 && ctxIdx <= 571) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_484_571[0][ctxIdx - 484][0];
            *n_out = mn_484_571[0][ctxIdx - 484][1];
        } else {
            *m_out = mn_484_571[cabac_init_idc + 1][ctxIdx - 484][0];
            *n_out = mn_484_571[cabac_init_idc + 1][ctxIdx - 484][1];
        }
    } else if (ctxIdx >= 572 && ctxIdx <= 659) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_572_659[0][ctxIdx - 572][0];
            *n_out = mn_572_659[0][ctxIdx - 572][1];
        } else {
            *m_out = mn_572_659[cabac_init_idc + 1][ctxIdx - 572][0];
            *n_out = mn_572_659[cabac_init_idc + 1][ctxIdx - 572][1];
        }
    } else if (ctxIdx >= 660 && ctxIdx <= 717) {
        if (is_slice_type_i) {
            *m_out = mn_660_717[0][ctxIdx - 660][0];
            *n_out = mn_660_717[0][ctxIdx - 660][1];
        } else {
            *m_out = mn_660_717[cabac_init_idc + 1][ctxIdx - 660][0];
            *n_out = mn_660_717[cabac_init_idc + 1][ctxIdx - 660][1];
        }
    } else if (ctxIdx >= 718 && ctxIdx <= 775) {
        if (is_slice_type_i) {
            *m_out = mn_718_775[0][ctxIdx - 718][0];
            *n_out = mn_718_775[0][ctxIdx - 718][1];
        } else {
            *m_out = mn_718_775[cabac_init_idc + 1][ctxIdx - 718][0];
            *n_out = mn_718_775[cabac_init_idc + 1][ctxIdx - 718][1];
        }
    } else if (ctxIdx >= 776 && ctxIdx <= 863) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_776_863[0][ctxIdx - 776][0];
            *n_out = mn_776_863[0][ctxIdx - 776][1];
        } else {
            *m_out = mn_776_863[cabac_init_idc + 1][ctxIdx - 776][0];
            *n_out = mn_776_863[cabac_init_idc + 1][ctxIdx - 776][1];
        }
    } else if (ctxIdx >= 864 && ctxIdx <= 951) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_864_951[0][ctxIdx - 864][0];
            *n_out = mn_864_951[0][ctxIdx - 864][1];
        } else {
            *m_out = mn_864_951[cabac_init_idc + 1][ctxIdx - 864][0];
            *n_out = mn_864_951[cabac_init_idc + 1][ctxIdx - 864][1];
        }
    } else if (ctxIdx >= 952 && ctxIdx <= 1011) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_952_1011[0][ctxIdx - 952][0];
            *n_out = mn_952_1011[0][ctxIdx - 952][1];
        } else {
            *m_out = mn_952_1011[cabac_init_idc + 1][ctxIdx - 952][0];
            *n_out = mn_952_1011[cabac_init_idc + 1][ctxIdx - 952][1];
        }
    } else if (ctxIdx >= 1012 && ctxIdx <= 1023) {
        if (is_slice_type_i || is_slice_type_si) {
            *m_out = mn_1012_1023[0][ctxIdx - 1012][0];
            *n_out = mn_1012_1023[0][ctxIdx - 1012][1];
        } else {
            *m_out = mn_1012_1023[cabac_init_idc + 1][ctxIdx - 1012][0];
            *n_out = mn_1012_1023[cabac_init_idc + 1][ctxIdx - 1012][1];
        }
    } else if (ctxIdx == 276) {
        /* @see 9.3.3.1 Derivation process for ctxIdx*/
        /* ctxIdx = 276 is assigned to the binIdx of mb_type indicating the I_PCM mode.*/
        return ERR_INVALID_CABAC_CONTEXT_INDEX;
    } else {
        return ERR_INVALID_CABAC_CONTEXT_INDEX;
    }

    return ERR_OK;
}

int cabac_init_context_variables(CABAC* cabac, uint32_t slice_type, uint32_t cabac_init_idc, int32_t SliceQPY) {
    /* @see 9.3.1.1 Initialization process for context variables*/

    int err_code = ERR_OK;

    int8_t m = 0;
    int8_t n = 0;

    for (int32_t ctxIdx = 0; ctxIdx < H264_MAX_CONTEXT_INDEX; ++ctxIdx) {
        err_code = cabac_retrieve_m_n(ctxIdx, slice_type, cabac_init_idc, &m, &n);
        if (err_code == ERR_OK) {
            int32_t tmp = ((m * clip3(0, 51, SliceQPY)) >> 4) + n;
            int32_t preCtxState = clip3(1, 126, tmp);

            if (preCtxState <= 63) {
                cabac->pStateIdx[ctxIdx] = 63 - preCtxState;
                cabac->valMPS[ctxIdx] = 0;
            } else {
                cabac->pStateIdx[ctxIdx] = preCtxState - 64;
                cabac->valMPS[ctxIdx] = 1;
            }
        } else {
            /* do nothing */
            /* when ctxIdx is 276, the function cabac_retrieve_m_n return value is not ERR_OK */
        }
    }

    return err_code;
}

/* 9.3.1.2 Initialization process for the arithmetic decoding engine */
int cabac_init_arithmetic_decoding_engine(RBSPReader* rbsp_reader, CABAC* cabac) {
    cabac->codIRange = 510;

    cabac->codIOffset = (int32_t)read_u(rbsp_reader, 9);

    return ERR_OK;
}

void cabac_decode_unary_binarization(RBSPReader* rbsp_reader, uint32_t* out_synElVal) {
    uint32_t val;

    *out_synElVal = 0;

    while (val = read_u(rbsp_reader, 1)) {
        ++(*out_synElVal);
    }
}

void cabac_decode_truncated_unary_binarization(RBSPReader* rbsp_reader, int32_t cMax, uint32_t* out_synElVal) {
    uint32_t val;
    int32_t bits = 0;

    *out_synElVal = 0;

    while (bits < cMax && (val = read_u(rbsp_reader, 1))) {
        ++(*out_synElVal);
        ++bits;
    }
}

/* 7.3.4 Slice data syntax */
int cabac_mb_skip_flag(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    uint32_t slice_type = slice_header->slice_type;
    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binVal = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */
    if ((slice_type % 5) == SLICE_TYPE_P || (slice_type % 5) == SLICE_TYPE_SP) {
        /* Type of binarization： FL, cMax=1 */
        /* maxBinIdxCtx: 0 */
        /* ctxIdxOffset: 11 */
        maxBinIdxCtx = 0;
        ctxIdxOffset = 11;
    } else if ((slice_type % 5) == SLICE_TYPE_B) {
        /* Type of binarization： FL, cMax=1 */
        /* maxBinIdxCtx: 0 */
        /* ctxIdxOffset: 24 */
        maxBinIdxCtx = 0;
        ctxIdxOffset = 24;
    } else {
        return ERR_UNSUPPORT_SLICE_TYPE_OF_BINARIZATION;
    }

    /* 9.3.3.1.1.1 Derivation process of ctxIdxInc for the syntax element mb_skip_flag */
    err_code = derivation_for_ctxIdxInc_mb_skip_flag(picture, slice_header, CurrMbAddr, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    *out_syntax_element = binVal;

    return ERR_OK;
}

/* 9.3.3.1.1.2 Derivation process of ctxIdxInc for the syntax element mb_field_decoding_flag */
int cabac_mb_field_decoding_flag(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binVal = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */

    /* Type of binarization: FL, cMax=1 */
    /* maxBinIdxCtx: 0 */
    /* ctxIdxOffset: 70 */
    maxBinIdxCtx = 0;
    ctxIdxOffset = 70;

    /* 9.3.3.1.1.2 Derivation process of ctxIdxInc for the syntax element mb_field_decoding_flag */
    err_code = derivation_for_ctxIdxInc_mb_field_decoding_flag(picture, slice_header, CurrMbAddr, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    *out_syntax_element = binVal;

    return ERR_OK;
}

int cabac_transform_size_8x8_flag(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binVal = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Type of binarization: FL, cMax=1 */
    /* maxBinIdxCtx: 0 */
    /* ctxIdxOffset: 399 */
    maxBinIdxCtx = 0;
    ctxIdxOffset = 399;

    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */

    /* 9.3.3.1.1.10 Derivation process of ctxIdxInc for the syntax element transform_size_8x8_flag */
    err_code = derivation_for_ctxIdxInc_transform_size_8x8_flag(picture, slice_header, CurrMbAddr, ctxIdxOffset, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    *out_syntax_element = binVal;

    return ERR_OK;
}

int cabac_mb_qp_delta(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binVal = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t num_1_len = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */

    /* Type of binarization: as specified in clause 9.3.2.7 */
    /* maxBinIdxCtx: 2 */
    /* ctxIdxOffset: 60 */
    maxBinIdxCtx = 2;
    ctxIdxOffset = 60;

    /* 9.3.3.1.1.5 Derivation process of ctxIdxInc for the syntax element mb_qp_delta */
    err_code = derivation_for_ctxIdxInc_mb_qp_delta(picture, slice_header, CurrMbAddr, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;

    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    /* The bin string of mb_qp_delta is derived by the U binarization of the mapped value of the syntax element mb_qp_delta, where the assignment rule between the signed value of
     * mb_qp_delta and its mapped value is given as specified in Table 9-3. */

    if (binVal == 0) {
        *out_syntax_element = 0;
    } else {
        ctxIdx = ctxIdxOffset + 2;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
        if (err_code < 0) {
            return err_code;
        }

        num_1_len = 1;

        while (binVal == 1) {
            ++num_1_len;

            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }
        }

        if (num_1_len & 0x01) {
            num_1_len = (num_1_len + 1) / 2;
        } else {
            num_1_len = -(num_1_len / 2);
        }

        *out_syntax_element = num_1_len;
    }

    return ERR_OK;
}

int cabac_end_of_slice_flag(RBSPReader* rbsp_reader, CABAC* cabac, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binVal = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */

    /* Type of binarization: FL, cMax=1 */
    maxBinIdxCtx = 0;
    ctxIdxOffset = 276;

    ctxIdx = ctxIdxOffset + ctxIdxInc;

    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    *out_syntax_element = binVal;

    return ERR_OK;
}

int cabac_coded_block_pattern(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t ChromaArrayType,
                              int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t maxBinIdxCtx = 0;
    int32_t ctxIdxOffset = 0;
    int32_t ctxIdxInc = 0;
    int32_t binIdx = 0;
    int32_t binVal = 0;
    int32_t binValues = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Type of binarization: prefix and suffix as specified in clause 9.3.2.6 */
    /* maxBinIdxCtx: (prefix: 3,  suffix: 1) */
    /* ctxIdxOffset: (prefix: 73, suffix: 77) */

    /* The binarization of coded_block_pattern consists of a prefix part and (when present) a suffix part. The prefix part of the binarization is given by the FL binarization of
     * CodedBlockPatternLuma with cMax = 15. When ChromaArrayType is not equal to 0 or 3, the suffix part is present and consists of the TU binarization of CodedBlockPatternChroma
     * with cMax = 2. The relationship between the value of the syntax element coded_block_pattern and the values of CodedBlockPatternLuma and CodedBlockPatternChroma is given as
     * specified in clause 7.4.5. */

    /******************************** the prefix ********************************/
    /* maxBinIdxCtx: (prefix: 3) */
    /* ctxIdxOffset: (prefix: 73) */
    maxBinIdxCtx = 3;
    ctxIdxOffset = 73;

    binIdx = 0;
    err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }
    binValues = binVal;

    binIdx = 1;
    err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }
    binValues += binVal << 1;

    binIdx = 2;
    err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }
    binValues += binVal << 2;

    binIdx = 3;
    err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }
    binValues += binVal << 3;

    /* The prefix part of the binarization is given by the FL binarization of CodedBlockPatternLuma with cMax = 15. */
    /* CodedBlockPatternLuma = coded_block_pattern % 16 */
    /* CodedBlockPatternChroma = coded_block_pattern / 16 */
    int32_t CodedBlockPatternLuma = binValues;

    /******************************** the suffix ********************************/
    int32_t CodedBlockPatternChroma = 0;

    /* maxBinIdxCtx: (prefix: 1) */
    /* ctxIdxOffset: (prefix: 77) */
    maxBinIdxCtx = 1;
    ctxIdxOffset = 77;

    /* When ChromaArrayType is not equal to 0 or 3, the suffix part is present and consists of the TU binarization of CodedBlockPatternChroma with cMax = 2.*/
    if (ChromaArrayType != 0 && ChromaArrayType != 3) {
        binValues = 0;

        binIdx = 0;
        err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
        if (err_code < 0) {
            return err_code;
        }

        ctxIdx = ctxIdxOffset + ctxIdxInc;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
        if (err_code < 0) {
            return err_code;
        }

        if (binVal == 0) {
            CodedBlockPatternChroma = 0;
        } else {
            CodedBlockPatternChroma = 1;

            binIdx = 1;
            err_code = derivation_for_ctxIdxInc_coded_block_pattern(picture, slice_header, CurrMbAddr, ctxIdxOffset, binIdx, binValues, &ctxIdxInc);
            if (err_code < 0) {
                return err_code;
            }

            ctxIdx = ctxIdxOffset + ctxIdxInc;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }

            if (binVal == 1) {
                CodedBlockPatternChroma = 2;
            }
        }
    }

    *out_syntax_element = CodedBlockPatternLuma + CodedBlockPatternChroma * 16;

    return ERR_OK;
}

int DecodeBin(RBSPReader* rbsp_reader, CABAC* cabac, int32_t bypassFlag, int32_t ctxIdx, int32_t* bin_val) {
    if (bypassFlag) {
        return DecodeBypass(rbsp_reader, cabac, bin_val);
    } else if (ctxIdx == 276) {
        return DecodeTerminate(rbsp_reader, cabac, bin_val);
    } else {
        return DecodeDecision(rbsp_reader, cabac, ctxIdx, bin_val);
    }
}

int DecodeBypass(RBSPReader* rbsp_reader, CABAC* cabac, int32_t* bin_val) {
    int32_t codIRange = cabac->codIRange;
    int32_t* codIOffset = &cabac->codIOffset;

    *codIOffset = *codIOffset << 1;
    *codIOffset = *codIOffset | (int32_t)read_u(rbsp_reader, 1);

    if (*codIOffset >= codIRange) {
        *bin_val = 1;
        *codIOffset = *codIOffset - codIRange;
    } else {
        *bin_val = 0;
    }

    return ERR_OK;
}

int DecodeTerminate(RBSPReader* rbsp_reader, CABAC* cabac, int32_t* bin_val) {
    int32_t* codIRange = &cabac->codIRange;
    int32_t* codIOffset = &cabac->codIOffset;

    *codIRange = *codIRange - 2;

    if (*codIOffset >= *codIRange) {
        *bin_val = 1;
    } else {
        *bin_val = 0;

        RenormD(rbsp_reader, cabac);
    }
}

int RenormD(RBSPReader* rbsp_reader, CABAC* cabac) {
    int32_t* codIRange = &cabac->codIRange;
    int32_t* codIOffset = &cabac->codIOffset;

    while (*codIRange < 256) {
        *codIRange = *codIRange << 1;
        *codIOffset = *codIOffset << 1;
        *codIOffset = *codIOffset | (int32_t)read_u(rbsp_reader, 1);
    }

    return ERR_OK;
}

int DecodeDecision(RBSPReader* rbsp_reader, CABAC* cabac, int32_t ctxIdx, int32_t* bin_val) {
    int32_t* codIRange = &cabac->codIRange;
    int32_t* codIOffset = &cabac->codIOffset;

    int32_t pStateIdx = cabac->pStateIdx[ctxIdx];
    int32_t valMPS = cabac->valMPS[ctxIdx];

    int32_t qCodIRangeIdx = (*codIRange >> 6) & 3;

    int32_t codIRangeLPS = rangeTabLPS[pStateIdx][qCodIRangeIdx];

    *codIRange = *codIRange - codIRangeLPS;

    if (*codIOffset >= *codIRange) {
        *bin_val = !valMPS;
        *codIOffset = *codIOffset - *codIRange;
        *codIRange = codIRangeLPS;

        if (pStateIdx == 0) {
            cabac->valMPS[ctxIdx] = 1 - valMPS;
        }

        cabac->pStateIdx[ctxIdx] = transIdxLPS[pStateIdx];
    } else {
        *bin_val = valMPS;
        cabac->pStateIdx[ctxIdx] = transIdxMPS[pStateIdx];
    }

    RenormD(rbsp_reader, cabac);

    return ERR_OK;
}

/* 9.3.3.1.1.1 Derivation process of ctxIdxInc for the syntax element mb_skip_flag */
int derivation_for_ctxIdxInc_mb_skip_flag(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_ctxIdxInc) {
    /* When MbaffFrameFlag is equal to 1 and mb_field_decoding_flag has not been decoded (yet) for the current macroblock pair with top macroblock address 2 * ( CurrMbAddr / 2 ),
     * the inference rule for the syntax element mb_field_decoding_flag as specified in clause 7.4.4 is applied. */

    /* The derivation process for neighbouring macroblocks specified in clause 6.4.11.1 is invoked and the output is assigned to mbAddrA and mbAddrB. */

    int err_code = ERR_OK;
    SPS* sps = slice_header->sps;
    PPS* pps = slice_header->pps;

    int32_t mbAddrA = 0;
    int32_t mbAddrB = 0;

    int32_t is_chroma = 0;

    /* 6.4.11.1 Derivation process for neighbouring macroblocks */
    neighbouring_macroblocks(slice_header->MbaffFrameFlag, CurrMbAddr, !picture->mb_list[CurrMbAddr].mb_field_decoding_flag, sps->PicWidthInMbs, picture->mb_slice_ids,
                             picture->mb_frame_flags, is_chroma, sps->MbWidthC, sps->MbHeightC, &mbAddrA, &mbAddrB);

    int32_t condTermFlagA = 0;
    int32_t condTermFlagB = 0;

    if (mbAddrA < 0 || picture->mb_list[mbAddrA].mb_skip_flag == 1) {
        condTermFlagA = 0;
    } else {
        condTermFlagA = 1;
    }

    if (mbAddrB < 0 || picture->mb_list[mbAddrB].mb_skip_flag == 1) {
        condTermFlagB = 0;
    } else {
        condTermFlagB = 1;
    }

    *out_ctxIdxInc = condTermFlagA + condTermFlagB;

    return ERR_OK;
}

/* 9.3.3.1.1.2 Derivation process of ctxIdxInc for the syntax element mb_field_decoding_flag */
int derivation_for_ctxIdxInc_mb_field_decoding_flag(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_ctxIdxInc) {
    /* The derivation process for neighbouring macroblock addresses and their availability in MBAFF frames as specified in clause 6.4.10 is invoked and the output is assigned to
     * mbAddrA and mbAddrB. */
    /* When both macroblocks mbAddrN and mbAddrN + 1 have mb_type equal to P_Skip or B_Skip, the inference rule for the syntax element mb_field_decoding_flag as specified in
     * clause 7.4.4 is applied for the macroblock mbAddrN. */

    int err_code = ERR_OK;
    SPS* sps = slice_header->sps;
    PPS* pps = slice_header->pps;

    int32_t mbAddrA = 0;
    int32_t mbAddrB = 0;

    /* 6.4.10 Derivation process for neighbouring macroblock addresses and their availability in MBAFF frames */
    err_code = neighbouring_mb_A_address_availability_in_MBAFF_frame(CurrMbAddr, sps->PicWidthInMbs, picture->mb_slice_ids, &mbAddrA);
    if (err_code < 0) {
        return err_code;
    }

    /* 6.4.10 Derivation process for neighbouring macroblock addresses and their availability in MBAFF frames */
    err_code = neighbouring_mb_B_address_availability_in_MBAFF_frame(CurrMbAddr, sps->PicWidthInMbs, picture->mb_slice_ids, &mbAddrB);
    if (err_code < 0) {
        return err_code;
    }

    int32_t condTermFlagA = 0;
    int32_t condTermFlagB = 0;

    if (mbAddrA < 0 || picture->mb_list[mbAddrA].mb_field_decoding_flag == 0) {
        condTermFlagA = 0;
    } else {
        condTermFlagA = 1;
    }

    if (mbAddrB < 0 || picture->mb_list[mbAddrB].mb_field_decoding_flag == 0) {
        condTermFlagB = 0;
    } else {
        condTermFlagB = 1;
    }

    *out_ctxIdxInc = condTermFlagA + condTermFlagB;

    return ERR_OK;
}

/* 9.3.3.1.1.3 Derivation process of ctxIdxInc for the syntax element mb_type */
int derivation_for_ctxIdxInc_mb_type(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t ctxIdxOffset, int32_t* out_ctxIdxInc) {
    int err_code = ERR_OK;

    SPS* sps = slice_header->sps;
    PPS* pps = slice_header->pps;

    int32_t mbAddrA = 0;
    int32_t mbAddrB = 0;
    int32_t is_chroma = 0;

    /* 6.4.11.1 Derivation process for neighbouring macroblocks */
    neighbouring_macroblocks(slice_header->MbaffFrameFlag, CurrMbAddr, !picture->mb_list[CurrMbAddr].mb_field_decoding_flag, sps->PicWidthInMbs, picture->mb_slice_ids,
                             picture->mb_frame_flags, is_chroma, sps->MbWidthC, sps->MbHeightC, &mbAddrA, &mbAddrB);

    int32_t condTermFlagA = 0;
    int32_t condTermFlagB = 0;

    if (mbAddrA < 0 || (ctxIdxOffset == 0 && picture->mb_list[mbAddrA].mb_type_name == SI_SI) || (ctxIdxOffset == 3 && picture->mb_list[mbAddrA].mb_type_name == I_NxN) ||
        (ctxIdxOffset == 27 && (picture->mb_list[mbAddrA].mb_type_name == B_Skip || picture->mb_list[mbAddrA].mb_type_name == B_Direct_16x16))) {
        condTermFlagA = 0;
    } else {
        condTermFlagA = 1;
    }

    if (mbAddrB < 0 || (ctxIdxOffset == 0 && picture->mb_list[mbAddrB].mb_type_name == SI_SI) || (ctxIdxOffset == 3 && picture->mb_list[mbAddrB].mb_type_name == I_NxN) ||
        (ctxIdxOffset == 27 && (picture->mb_list[mbAddrB].mb_type_name == B_Skip || picture->mb_list[mbAddrB].mb_type_name == B_Direct_16x16))) {
        condTermFlagB = 0;
    } else {
        condTermFlagB = 1;
    }

    *out_ctxIdxInc = condTermFlagA + condTermFlagB;

    return ERR_OK;
}

/* 9.3.3.1.1.4 Derivation process of ctxIdxInc for the syntax element coded_block_pattern */
int derivation_for_ctxIdxInc_coded_block_pattern(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t ctxIdxOffset, int32_t binIdx, int32_t binValues,
                                                 int32_t* out_ctxIdxInc) {
    int err_code = ERR_OK;

    SPS* sps = slice_header->sps;
    PPS* pps = slice_header->pps;

    if (ctxIdxOffset == 73) {
        int32_t mbAddrA = 0;
        int32_t mbAddrB = 0;
        int32_t luma8x8BlkIdxA = 0;
        int32_t luma8x8BlkIdxB = 0;

        /* 6.4.11.2 Derivation process for neighbouring 8x8 luma block */
        neighbouring_8x8_luma_block(slice_header->MbaffFrameFlag, CurrMbAddr, !picture->mb_list[CurrMbAddr].mb_field_decoding_flag, sps->PicWidthInMbs, picture->mb_slice_ids,
                                    picture->mb_frame_flags, binIdx, &mbAddrA, &luma8x8BlkIdxA, &mbAddrB, &luma8x8BlkIdxB);

        int32_t condTermFlagA = 0;
        int32_t condTermFlagB = 0;

        if (mbAddrA < 0 || picture->mb_list[mbAddrA].mb_type_name == I_PCM ||
            (mbAddrA != CurrMbAddr && (picture->mb_list[mbAddrA].mb_type_name != P_Skip && picture->mb_list[mbAddrA].mb_type_name != B_Skip) &&
             ((picture->mb_list[mbAddrA].CodedBlockPatternLuma >> luma8x8BlkIdxA) & 1) != 0) ||
            (mbAddrA == CurrMbAddr && ((binValues >> luma8x8BlkIdxA) & 0x01) != 0)) {
            condTermFlagA = 0;
        } else {
            condTermFlagA = 1;
        }

        if (mbAddrB < 0 || picture->mb_list[mbAddrB].mb_type_name == I_PCM ||
            (mbAddrB != CurrMbAddr && (picture->mb_list[mbAddrB].mb_type_name != P_Skip && picture->mb_list[mbAddrB].mb_type_name != B_Skip) &&
             ((picture->mb_list[mbAddrB].CodedBlockPatternLuma >> luma8x8BlkIdxB) & 1) != 0) ||
            (mbAddrB == CurrMbAddr && ((binValues >> luma8x8BlkIdxB) & 0x01) != 0)) {
            condTermFlagB = 0;
        } else {
            condTermFlagB = 1;
        }

        *out_ctxIdxInc = condTermFlagA + 2 * condTermFlagB;
    } else if (ctxIdxOffset == 77) {
        int32_t mbAddrA = 0;
        int32_t mbAddrB = 0;

        int32_t is_chroma = 0;

        /* 6.4.11.1 Derivation process for neighbouring macroblocks */
        neighbouring_macroblocks(slice_header->MbaffFrameFlag, CurrMbAddr, !picture->mb_list[CurrMbAddr].mb_field_decoding_flag, sps->PicWidthInMbs, picture->mb_slice_ids,
                                 picture->mb_frame_flags, is_chroma, sps->MbWidthC, sps->MbHeightC, &mbAddrA, &mbAddrB);

        int32_t condTermFlagA = 0;
        int32_t condTermFlagB = 0;

        if (mbAddrA >= 0 && picture->mb_list[mbAddrA].mb_type_name == I_PCM) {
            condTermFlagA = 1;
        } else if (mbAddrA < 0 || picture->mb_list[mbAddrA].mb_type_name == P_Skip || picture->mb_list[mbAddrA].mb_type_name == B_Skip ||
                   (binIdx == 0 && picture->mb_list[mbAddrA].CodedBlockPatternChroma == 0) || (binIdx == 1 && picture->mb_list[mbAddrA].CodedBlockPatternChroma != 2)) {
            condTermFlagA = 0;
        } else {
            condTermFlagA = 1;
        }

        if (mbAddrB >= 0 && picture->mb_list[mbAddrB].mb_type_name == I_PCM) {
            condTermFlagB = 1;
        } else if (mbAddrB < 0 || picture->mb_list[mbAddrB].mb_type_name == P_Skip || picture->mb_list[mbAddrB].mb_type_name == B_Skip ||
                   (binIdx == 0 && picture->mb_list[mbAddrB].CodedBlockPatternChroma == 0) || (binIdx == 1 && picture->mb_list[mbAddrB].CodedBlockPatternChroma != 2)) {
            condTermFlagB = 0;
        } else {
            condTermFlagB = 1;
        }

        *out_ctxIdxInc = condTermFlagA + 2 * condTermFlagB + ((binIdx == 1) ? 4 : 0);

    } else {
        return ERR_INVALID_CTXIDXOFFSET_4_CODED_BLOCK_PATTERN;
    }

    return ERR_OK;
}

/* 9.3.3.1.1.5 Derivation process of ctxIdxInc for the syntax element mb_qp_delta */
int derivation_for_ctxIdxInc_mb_qp_delta(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_ctxIdxInc) {
    int err_code = ERR_OK;

    int32_t prevMbAddr = CurrMbAddr - 1;
    int32_t first_mb_addr = slice_header->first_mb_in_slice * (1 + slice_header->MbaffFrameFlag);

    if (CurrMbAddr == first_mb_addr) {
        prevMbAddr = -1;
    }

    if (prevMbAddr < 0 || picture->mb_list[prevMbAddr].mb_type_name == P_Skip || picture->mb_list[prevMbAddr].mb_type_name == B_Skip ||
        picture->mb_list[prevMbAddr].mb_type_name == I_PCM ||
        (picture->mb_list[prevMbAddr].mb_pred_type != Intra_16x16 && picture->mb_list[prevMbAddr].CodedBlockPatternLuma == 0 &&
         picture->mb_list[prevMbAddr].CodedBlockPatternChroma == 0) ||
        picture->mb_list[prevMbAddr].mb_qp_delta == 0) {
        *out_ctxIdxInc = 0;
    } else {
        *out_ctxIdxInc = 1;
    }

    return ERR_OK;
}

/* 9.3.3.1.1.10 Derivation process of ctxIdxInc for the syntax element transform_size_8x8_flag */
int derivation_for_ctxIdxInc_transform_size_8x8_flag(FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t ctxIdxOffset, int32_t* out_ctxIdxInc) {
    int err_code = ERR_OK;

    SPS* sps = slice_header->sps;
    PPS* pps = slice_header->pps;

    int32_t mbAddrA = 0;
    int32_t mbAddrB = 0;
    int32_t is_chroma = 0;

    /* 6.4.11.1 Derivation process for neighbouring macroblocks */
    neighbouring_macroblocks(slice_header->MbaffFrameFlag, CurrMbAddr, !picture->mb_list[CurrMbAddr].mb_field_decoding_flag, sps->PicWidthInMbs, picture->mb_slice_ids,
                             picture->mb_frame_flags, is_chroma, sps->MbWidthC, sps->MbHeightC, &mbAddrA, &mbAddrB);

    int32_t condTermFlagA = 0;
    int32_t condTermFlagB = 0;

    if (mbAddrA < 0 || (picture->mb_list[mbAddrA].transform_size_8x8_flag == 0)) {
        condTermFlagA = 0;
    } else {
        condTermFlagA = 1;
    }

    if (mbAddrB < 0 || (picture->mb_list[mbAddrB].transform_size_8x8_flag == 0)) {
        condTermFlagB = 0;
    } else {
        condTermFlagB = 1;
    }

    *out_ctxIdxInc = condTermFlagA + condTermFlagB;
    return ERR_OK;
}

int cabac_mb_type(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    uint32_t slice_type = slice_header->slice_type % 5;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */

    if (slice_type == SLICE_TYPE_I) {
        /* Type of binarization: as specified in clause 9.3.2.5, maxBinIdxCtx: 6, ctxIdxOffset: 3*/
        int32_t maxBinIdxCtx = 6;
        int32_t ctxIdxOffset = 3;
        return cabac_mb_type_for_I_slices(rbsp_reader, cabac, picture, slice_header, CurrMbAddr, maxBinIdxCtx, ctxIdxOffset, out_syntax_element);
    } else if (slice_type == SLICE_TYPE_SI) {
        /* Type of binarization: prefix and suffix as specified in clause 9.3.2.5, maxBinIdxCtx: (prefix:0, suffix:6), ctxIdxOffset: (prefix: 0, suffix: 3)*/
        int32_t maxBinIdxCtx = 6;
        int32_t ctxIdxOffset = 3;
        return cabac_mb_type_for_SI_slices(rbsp_reader, cabac, picture, slice_header, CurrMbAddr, maxBinIdxCtx, ctxIdxOffset, out_syntax_element);
    } else if (slice_type == SLICE_TYPE_B) {
        /* Type of binarization: prefix and suffix as specified in clause 9.3.2.5, maxBinIdxCtx: (prefix:3, suffix:5), ctxIdxOffset: (prefix: 27, suffix: 32)*/
        int32_t maxBinIdxCtx = -1;
        int32_t ctxIdxOffset = -1;
        return cabac_mb_type_for_B_slices(rbsp_reader, cabac, picture, CurrMbAddr, maxBinIdxCtx, ctxIdxOffset, out_syntax_element);
    } else if (slice_type == SLICE_TYPE_P || slice_type == SLICE_TYPE_SP) {
        /* Type of binarization: prefix and suffix as specified in clause 9.3.2.5, maxBinIdxCtx: (prefix:2, suffix:5), ctxIdxOffset: (prefix: 14, suffix: 17)*/
        int32_t maxBinIdxCtx = -1;
        int32_t ctxIdxOffset = -1;
        return cabac_mb_type_for_P_SP_slices(rbsp_reader, cabac, picture, CurrMbAddr, maxBinIdxCtx, ctxIdxOffset, out_syntax_element);
    } else {
        return ERR_INVALID_SLICE_TYPE;
    }

    return ERR_OK;
}

static int cabac_mb_type_for_I_slices_binIdx3_start(RBSPReader* rbsp_reader, CABAC* cabac, int32_t ctxIdxOffset, int32_t binIdx2Val, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t ctxIdxInc = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t binIdx3Val = 0;
    int32_t binIdx4Val = 0;
    int32_t binIdx5Val = 0;
    int32_t binIdx6Val = 0;

    ctxIdx = ctxIdxOffset + 4;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx3Val); /* binIdx = 3 */
    if (err_code < 0) {
        return err_code;
    }

    /* Table 9-41 – Specification of ctxIdxInc for specific values of ctxIdxOffset and binIdx */
    if (binIdx3Val == 0) {                                                         /* b3 == 0*/
        ctxIdx = ctxIdxOffset + 6;                                                 /* binIdx 4: (b3 != 0) ? 5: 6*/
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx4Val); /* binIdx = 4 */
        if (err_code < 0) {
            return err_code;
        }

        ctxIdx = ctxIdxOffset + 7;                                                 /* binIdx 5: (b3 != 0) ? 6: 7*/
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx5Val); /* binIdx = 5 */
        if (err_code < 0) {
            return err_code;
        }

    } else {                                                                       /* b3 != 0*/
        ctxIdx = ctxIdxOffset + 5;                                                 /* binIdx 4: (b3 != 0) ? 5: 6*/
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx4Val); /* binIdx = 4 */
        if (err_code < 0) {
            return err_code;
        }

        ctxIdx = ctxIdxOffset + 6;                                                 /* binIdx 5: (b3 != 0) ? 6: 7*/
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx5Val); /* binIdx = 5 */
        if (err_code < 0) {
            return err_code;
        }

        ctxIdx = ctxIdxOffset + 7;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binIdx6Val); /* binIdx = 6 */
        if (err_code < 0) {
            return err_code;
        }
    }

    if (binIdx2Val == 0) {
        if (binIdx3Val == 0) {
            if (binIdx4Val == 0) {
                if (binIdx5Val == 0) {
                    *out_syntax_element = 1; /* 1 (I_16x16_0_0_0) */
                } else {
                    *out_syntax_element = 2; /* 2 (I_16x16_1_0_0) */
                }
            } else {
                if (binIdx5Val == 0) {
                    *out_syntax_element = 3; /* 3 (I_16x16_2_0_0) */
                } else {
                    *out_syntax_element = 4; /* 4 (I_16x16_3_0_0)  */
                }
            }
        } else {
            if (binIdx4Val == 0) {
                if (binIdx5Val == 0) {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 5; /* 5 (I_16x16_0_1_0)  */
                    } else {
                        *out_syntax_element = 6; /* 6 (I_16x16_1_1_0)  */
                    }

                } else {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 7; /* 7 (I_16x16_2_1_0)  */
                    } else {
                        *out_syntax_element = 8; /* 8 (I_16x16_3_1_0)  */
                    }
                }
            } else {
                if (binIdx5Val == 0) {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 9; /* 9 (I_16x16_0_2_0)  */
                    } else {
                        *out_syntax_element = 10; /* 10 (I_16x16_1_2_0)  */
                    }
                } else {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 11; /* 11 (I_16x16_2_2_0)  */
                    } else {
                        *out_syntax_element = 12; /* 12 (I_16x16_3_2_0)  */
                    }
                }
            }
        }
    } else {
        if (binIdx3Val == 0) {
            if (binIdx4Val == 0) {
                if (binIdx5Val == 0) {
                    *out_syntax_element = 13; /* 13 (I_16x16_0_0_1) */
                } else {
                    *out_syntax_element = 14; /* 14 (I_16x16_1_0_1) */
                }
            } else {
                if (binIdx5Val == 0) {
                    *out_syntax_element = 15; /* 15 (I_16x16_2_0_1)  */
                } else {
                    *out_syntax_element = 16; /* 16 (I_16x16_3_0_1)  */
                }
            }
        } else {
            if (binIdx4Val == 0) {
                if (binIdx5Val == 0) {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 17; /* 17 (I_16x16_0_1_1)  */
                    } else {
                        *out_syntax_element = 18; /* 18 (I_16x16_1_1_1)  */
                    }

                } else {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 19; /* 19 (I_16x16_2_1_1)  */
                    } else {
                        *out_syntax_element = 20; /* 20 (I_16x16_3_1_1)  */
                    }
                }
            } else {
                if (binIdx5Val == 0) {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 21; /* 21 (I_16x16_0_2_1)  */
                    } else {
                        *out_syntax_element = 22; /* 22 (I_16x16_1_2_1)  */
                    }
                } else {
                    if (binIdx6Val == 0) {
                        *out_syntax_element = 23; /* 23 (I_16x16_2_2_1)  */
                    } else {
                        *out_syntax_element = 24; /* 24 (I_16x16_3_2_1)  */
                    }
                }
            }
        }
    }

    return ERR_OK;
}

/* Table 9-36 – Binarization for macroblock types in I slices */
int cabac_mb_type_for_I_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t maxBinIdxCtx,
                               int32_t ctxIdxOffset, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t ctxIdxInc = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t binVal = 0;

    /* 9.3.3.1.1.3 Derivation process of ctxIdxInc for the syntax element mb_type */
    err_code = derivation_for_ctxIdxInc_mb_type(picture, slice_header, CurrMbAddr, ctxIdxOffset, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    /* Table 9-36 – Binarization for macroblock types in I slices */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */
    /* Table 9-41 – Specification of ctxIdxInc for specific values of ctxIdxOffset and binIdx */
    if (binVal == 0) {           /* binIdx = 0 */
        *out_syntax_element = 0; /* 0 (I_NxN) */
    } else {
        /* ctxIdx = 276 is assigned to the binIdx of mb_type indicating the I_PCM mode.*/
        /* see Table 9-39 */
        ctxIdx = 276;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal); /* binIdx = 1 */
        if (err_code < 0) {
            return err_code;
        }

        if (binVal == 1) {
            *out_syntax_element = 25; /* 25 (I_PCM) */
        } else {
            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal); /* binIdx = 2 */
            if (err_code < 0) {
                return err_code;
            }

            err_code = cabac_mb_type_for_I_slices_binIdx3_start(rbsp_reader, cabac, ctxIdxOffset, binVal, out_syntax_element);
            if (err_code < 0) {
                return err_code;
            }
        }
    }

    if (*out_syntax_element == 25) {
        err_code = cabac_init_arithmetic_decoding_engine(rbsp_reader, cabac);
        if (err_code < 0) {
            return err_code;
        }
    }

    return ERR_OK;
}

/* 9.3.2.5 Binarization process for macroblock type and sub-macroblock type */
int cabac_mb_type_for_SI_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t maxBinIdxCtx,
                                int32_t ctxIdxOffset, int32_t* out_syntax_element) {
    int err_code = ERR_OK;
    int32_t ctxIdxInc = 0;
    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t binVal = 0;

    /* 9.3.3.1.1.3 Derivation process of ctxIdxInc for the syntax element mb_type */
    err_code = derivation_for_ctxIdxInc_mb_type(picture, slice_header, CurrMbAddr, ctxIdxOffset, &ctxIdxInc);
    if (err_code < 0) {
        return err_code;
    }

    ctxIdx = ctxIdxOffset + ctxIdxInc;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    /* For macroblock types in SI slices, the binarization consists of bin strings specified as a concatenation of a prefix and a suffix bit string as follows. */

    /* The prefix bit string consists of a single bit, which is specified by b0 = ( ( mb_type = = SI ) ? 0 : 1 ). For the syntax element value for which b0 is equal to 0, the bin
     * string only consists of the prefix bit string. For the syntax element value for which b0 is equal to 1, the binarization is given by concatenating the prefix b0 and the
     * suffix bit string as specified in Table 9-36 for macroblock type in I slices indexed by subtracting 1 from the value of mb_type in SI slices. */

    if (binVal == 0) {
        *out_syntax_element = 0; /*0 (I_NxN) */
    } else {
        /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
        /* Type of binarization: as specified in clause 9.3.2.5, maxBinIdxCtx: 6, ctxIdxOffset: 3*/
        maxBinIdxCtx = 6;
        ctxIdxOffset = 3;

        err_code = cabac_mb_type_for_I_slices(rbsp_reader, cabac, picture, slice_header, CurrMbAddr, maxBinIdxCtx, ctxIdxOffset, out_syntax_element);
        if (err_code < 0) {
            return err_code;
        }

        *out_syntax_element += 1;
    }

    return ERR_OK;
}

int cabac_mb_type_for_B_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, int32_t CurrMbAddr, int32_t maxBinIdxCtx, int32_t ctxIdxOffset,
                               int32_t* out_syntax_element) {
    /*TODO*/
    return ERR_NOT_IMPL;
}

int cabac_mb_type_for_P_SP_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, int32_t CurrMbAddr, int32_t maxBinIdxCtx, int32_t ctxIdxOffset,
                                  int32_t* out_syntax_element) {
    /*TODO*/
    return ERR_NOT_IMPL;
}

/* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
int cabac_sub_mb_type(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    uint32_t slice_type = slice_header->slice_type % 5;

    /* Table 9-34 – Syntax elements and associated types of binarization, maxBinIdxCtx, and ctxIdxOffset */
    if (slice_type == SLICE_TYPE_P || slice_type == SLICE_TYPE_SP) {
        /* Type of binarization : as specified in clause 9.3.2.5 2 21 */
        /* maxBinIdxCtx: 2 */
        /* ctxIdxOffset: 21 */
        err_code = cabac_sub_mb_type_for_P_SP_slices(rbsp_reader, cabac, picture, CurrMbAddr, out_syntax_element);
        if (err_code < 0) {
            return err_code;
        }
    } else if (slice_type == SLICE_TYPE_B) {
        /* Type of binarization : as specified in clause 9.3.2.5 */
        /* maxBinIdxCtx: 3 */
        /* ctxIdxOffset: 36 */
        err_code = cabac_sub_mb_type_for_B_slices(rbsp_reader, cabac, picture, CurrMbAddr, out_syntax_element);
        if (err_code < 0) {
            return err_code;
        }
    } else {
        return ERR_INVALID_SLICE_TYPE;
    }

    return ERR_OK;
}

int cabac_sub_mb_type_for_B_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t binVal = 0;

    int32_t maxBinIdxCtx = 3;
    int32_t ctxIdxOffset = 36;

    int32_t binIdx0Val = 0;
    int32_t binIdx1Val = 0;
    int32_t binIdx2Val = 0;
    int32_t binIdx3Val = 0;
    int32_t binIdx4Val = 0;
    int32_t binIdx5Val = 0;

    /* Table 9-38 – Binarization for sub-macroblock types in P, SP, and B slices */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */
    /* Table 9-41 – Specification of ctxIdxInc for specific values of ctxIdxOffset and binIdx*/
    ctxIdx = ctxIdxOffset;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    binIdx0Val = binVal;

    if (binIdx0Val == 0) {
        *out_syntax_element = 0; /* 0 (B_Direct_8x8) */
    }

    /* Table 9-39 */
    /* ctxIdxOffset   |                  binIdx                             */
    /* ctxIdxOffset   |   0  | 1  |            2          | 3 | 4 | 5 | >=6 */
    /* 36             |   0  | 1  | 2,3(clause 9.3.3.1.2) | 3 | 3 | 3 | na  */

    /* Table 9-41 – Specification of ctxIdxInc for specific values of ctxIdxOffset and binIdx */
    /* Value (name) of ctxIdxOffset | binIdx |   ctxIdxInc         */
    /* 36                           |    2   |   (b1 != 0) ? 2: 3  */

    /* for binIdx 1 */
    ctxIdx = ctxIdxOffset + 1;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }
    binIdx1Val = binVal;

    /* for binIdx 2*/
    if (binIdx1Val != 0) {
        ctxIdx = ctxIdxOffset + 2;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
        if (err_code < 0) {
            return err_code;
        }
        binIdx2Val = binVal;

        /* for binIdx 3*/
        if (binIdx2Val == 0) {
            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }
            binIdx3Val = binVal;

            /* for binIdx 4*/
            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }
            binIdx4Val = binVal;

            if (binIdx3Val == 0) {
                if (binIdx4Val == 0) {
                    *out_syntax_element = 3; /* 3 (B_Bi_8x8)  */
                } else {
                    *out_syntax_element = 4; /* 4 (B_L0_8x4)  */
                }
            } else {
                if (binIdx4Val == 0) {
                    *out_syntax_element = 5; /* 5 (B_L0_4x8)  */
                } else {
                    *out_syntax_element = 6; /* 6 (B_L1_8x4)  */
                }
            }
        } else {
            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }
            binIdx3Val = binVal;

            /* for binIdx 4*/
            ctxIdx = ctxIdxOffset + 3;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }
            binIdx4Val = binVal;

            /* for binIdx 5*/
            if (binIdx3Val == 0) {
                ctxIdx = ctxIdxOffset + 3;
                err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
                if (err_code < 0) {
                    return err_code;
                }
                binIdx5Val = binVal;

                if (binIdx4Val == 0) {
                    if (binIdx5Val == 0) {
                        *out_syntax_element = 7; /* 7 (B_L1_4x8)  */
                    } else {
                        *out_syntax_element = 8; /* 8 (B_Bi_8x4) */
                    }
                } else {
                    if (binIdx5Val == 0) {
                        *out_syntax_element = 9; /* 9 (B_Bi_4x8)  */
                    } else {
                        *out_syntax_element = 10; /* 10 (B_L0_4x4) */
                    }
                }
            } else {
                if (binIdx4Val == 0) {
                    *out_syntax_element = 11; /* 11 (B_L1_4x4)  */
                } else {
                    *out_syntax_element = 12; /* 12 (B_Bi_4x4)  */
                }
            }
        }

    } else {
        ctxIdx = ctxIdxOffset + 3;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
        if (err_code < 0) {
            return err_code;
        }
        binIdx2Val = binVal;

        if (binIdx2Val == 0) {
            *out_syntax_element = 1; /*1 (B_L0_8x8) */
        } else {
            *out_syntax_element = 2; /*2 (B_L1_8x8)  */
        }
    }

    return ERR_OK;
}

int cabac_sub_mb_type_for_P_SP_slices(RBSPReader* rbsp_reader, CABAC* cabac, FrameOrField* picture, SliceHeader* slice_header, int32_t CurrMbAddr, int32_t* out_syntax_element) {
    int err_code = ERR_OK;

    int32_t ctxIdx = 0;
    int32_t bypassFlag = 0;
    int32_t binVal = 0;

    int32_t maxBinIdxCtx = 2;
    int32_t ctxIdxOffset = 21;

    /* Table 9-38 – Binarization for sub-macroblock types in P, SP, and B slices */
    /* Table 9-39 – Assignment of ctxIdxInc to binIdx for all ctxIdxOffset values except those related to the syntax elements coded_block_flag, significant_coeff_flag,
     * last_significant_coeff_flag, and coeff_abs_level_minus1 */
    ctxIdx = ctxIdxOffset;
    err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
    if (err_code < 0) {
        return err_code;
    }

    if (binVal == 1) {
        *out_syntax_element = 0; /* 0 (P_L0_8x8)  */
    } else {
        ctxIdx = ctxIdxOffset + 1;
        err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
        if (err_code < 0) {
            return err_code;
        }

        if (binVal == 0) {
            *out_syntax_element = 1; /* 1 (P_L0_8x4) */
        } else {
            ctxIdx = ctxIdxOffset + 2;
            err_code = DecodeBin(rbsp_reader, cabac, bypassFlag, ctxIdx, &binVal);
            if (err_code < 0) {
                return err_code;
            }

            if (binVal == 1) {
                *out_syntax_element = 2; /* 2 (P_L0_4x8)  */
            } else {
                *out_syntax_element = 3; /* 3 (P_L0_4x4)  */
            }
        }
    }

    return ERR_OK;
}